(this["webpackJsonpsimplevr-simplified"]=this["webpackJsonpsimplevr-simplified"]||[]).push([[0],{150:function(t,e,n){},194:function(t,e,n){"use strict";n.r(e);var a=n(0),o=n.n(a),r=n(18),i=n.n(r),s=n(17),c=(n(150),n(55)),u=n(27),l=n(257),d=n(255),p=n(256),h=n(4),m=n.n(h),b=n(8),f=n(235),j=n(245),g=n(258),x=n(197),v=n(237),y=n(244),O=n(13),w=n(14),k=n(37),C=n.n(k),I=n(239),S=n(269),N=n(240),A=n(241),R=n(242),E=n(243),D=n(263),T=n(274),P="SET_USER",U="CLEAR_USER",L="SET_USER_DISPLAYNAME",F="SET_USER_STORIES",z="SET_PUBLIC_STORIES",_="SET_IS_SHOWING_SIGNIN_DIALOG",M="SET_STORY",B="SET_CURRENT_ROOM",H="ADD_HOTSPOT",W="ADD_DOOR",q="ADD_ROOM",Y="SET_HOTSPOT_LOCATION",X="SET_STORY_NAME",$="SET_STORY_TAGS",G="SET_STORY_SOUNDTRACK",V="SET_PROJECT",J="UPDATE_DOOR",K="SET_ROOM_NAME",Z="SET_ROOM_BACKGROUND",Q="SET_HOTSPOT_NAME",tt="SET_HOTSPOT_TEXT",et="SET_HOTSPOT_IMAGE",nt="SET_HOTSPOT_AUDIO",at="SET_ROOM_BACKGROUND_MUSIC",ot="SET_ROOM_BACKGROUND_NARRATION",rt="SET_ROOM_IS_HOME",it=function(t){return{type:P,payload:{value:t}}},st=function(t){return{type:_,payload:{value:t}}},ct=function(t){return{type:V,payload:{project:t}}},ut=function(t){return{type:M,payload:{value:t}}},lt=function(t){return{type:B,payload:{room:t}}},dt=function(t,e){return{type:H,payload:{hotspot:t,roomId:e}}},pt=n(11),ht=n(49),mt=(n(153),n(195),n(196),n(31)),bt=n(261),ft=function t(e,n){Object(pt.a)(this,t),this.id=Object(bt.a)(),this.data=e,this.fileName=n,this.extension="",this.volume=.5,this.loop=!1},jt=function(){function t(){Object(pt.a)(this,t),this.name="My Story",this.soundtrack=new ft,this.tags=[],this.rooms=[]}return Object(mt.a)(t,[{key:"getActiveRoom",value:function(){return this.rooms.find((function(t){return t.active}))}}]),t}(),gt=function t(){Object(pt.a)(this,t),this.id=Object(bt.a)(),this.isPublic=!1,this.story=new jt},xt=function t(e){Object(pt.a)(this,t),this.id=Object(bt.a)(),this.data=e,this.extension="",this.preloaded=!1},vt=function t(){Object(pt.a)(this,t),this.id=Object(bt.a)(),this.name="New Room",this.active=!1,this.isHome=!1,this.panoramaUrl={backgroundImage:new xt,thumbnail:new xt},this.backgroundMusic=new ft,this.backgroundNarration=new ft,this.hotspots=[],this.doors=[]};function yt(){return 10*(Math.random()>.5?-1:1)*Math.random()}var Ot=function(){function t(e,n){Object(pt.a)(this,t),this.x=e,this.y=n}return Object(mt.a)(t,[{key:"getX",value:function(){return this.x}},{key:"setX",value:function(t){this.x=t}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(t){this.y=t}},{key:"setPosition",value:function(t,e){this.x=t,this.y=e}},{key:"toString",value:function(){return"<".concat(this.x,",").concat(this.y,">")}},{key:"distanceTo",value:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}}],[{key:"build",value:function(){return new t(180+yt(),yt())}}]),t}(),wt=function t(){Object(pt.a)(this,t),this.id=Object(bt.a)(),this.label="Hotspot",this.text="",this.image=new xt,this.audio=new ft,this.location=new Ot},kt=function t(){Object(pt.a)(this,t),this.id=Object(bt.a)(),this.label="Door",this.targetRoomId="",this.location=new Ot},Ct=function(){function t(){Object(pt.a)(this,t),this.downloadUrlsMap=new Map}return Object(mt.a)(t,[{key:"deserialize",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.getDownloadUrlsForProjectAssets(e);case 2:return(n=new gt).id=e.id,n.isPublic=e.isPublic,n.story=this.deserializeStoryData(e.story),t.abrupt("return",n);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"deserializeStoryData",value:function(t){var e=this,n=new jt;return n.name=t.name,n.tags=t.tags?t.tags.split(","):[],t.soundtrack&&(n.soundtrack=this.deserializeSoundtrackData(t.soundtrack)),t.rooms.forEach((function(t){n.rooms.push(e.deserializeRoomData(t))})),n}},{key:"deserializeRoomData",value:function(t){var e=this,n=new vt;return n.id=t.id,n.name=t.name,n.isHome=t.isHome,n.panoramaUrl.backgroundImage=this.deserializeImageAssetData(t.panorama),n.panoramaUrl.thumbnail=this.deserializeImageAssetData(t.thumbnail),t.music&&(n.backgroundMusic=this.deserializeSoundtrackData(t.music)),t.narration&&(n.backgroundNarration=this.deserializeSoundtrackData(t.narration)),t.hotspots.forEach((function(t){n.hotspots.push(e.deserializeHotspotData(t))})),t.doors.forEach((function(t){n.doors.push(e.deserializeDoorData(t))})),n}},{key:"deserializeHotspotData",value:function(t){var e=new wt;return e.id=t.id,e.label=t.label,e.text=t.text,e.location=this.deserializeLocationData(t.location),t.image&&(e.image=this.deserializeImageAssetData(t.image)),t.audio&&(e.audio=this.deserializeSoundtrackData(t.audio)),e}},{key:"deserializeDoorData",value:function(t){var e=new kt;return e.id=t.id,e.label=t.label,e.targetRoomId=t.targetRoomId,e.location=this.deserializeLocationData(t.location),e}},{key:"deserializeSoundtrackData",value:function(t){var e=new ft;return e.id=t.id,e.fileName=t.fileName,e.extension=t.extension,e.volume=t.volume,e.data=this.downloadUrlsMap.get(t.id),e}},{key:"deserializeImageAssetData",value:function(t){var e=new xt;return e.id=t.id,e.extension=t.extension,e.data=this.downloadUrlsMap.get(t.id),e}},{key:"deserializeLocationData",value:function(t){return new Ot(t.x,t.y)}},{key:"getDownloadUrlsForProjectAssets",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n,a,o=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],(a=e.story).soundtrack&&n.push(this.getDownloadUrlForAsset(a.soundtrack.remoteFilePath,a.soundtrack.id)),a.rooms.forEach((function(t){n.push(o.getDownloadUrlForAsset(t.panorama.remoteFilePath,t.panorama.id)),n.push(o.getDownloadUrlForAsset(t.thumbnail.remoteFilePath,t.thumbnail.id)),t.music&&n.push(o.getDownloadUrlForAsset(t.music.remoteFilePath,t.music.id)),t.narration&&n.push(o.getDownloadUrlForAsset(t.narration.remoteFilePath,t.narration.id)),t.hotspots.forEach((function(t){t.image&&n.push(o.getDownloadUrlForAsset(t.image.remoteFilePath,t.image.id)),t.audio&&n.push(o.getDownloadUrlForAsset(t.audio.remoteFilePath,t.audio.id))}))})),t.next=7,Promise.all(n);case 7:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"getDownloadUrlForAsset",value:function(){var t=Object(b.a)(m.a.mark((function t(e,n){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Lt.getDownloadUrl(e);case 2:a=t.sent,this.downloadUrlsMap.set(n,a);case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}(),It=function t(){Object(pt.a)(this,t),this.id=void 0,this.isPublic=void 0,this.userId=void 0,this.story=void 0},St=function t(){Object(pt.a)(this,t),this.name=void 0,this.tags=void 0,this.soundtrack=void 0,this.rooms=[]},Nt=function t(){Object(pt.a)(this,t),this.id=void 0,this.name=void 0,this.isHome=void 0,this.panorama=void 0,this.thumbnail=void 0,this.music=void 0,this.narration=void 0,this.hotspots=[],this.doors=[]},At=function t(){Object(pt.a)(this,t),this.id=void 0,this.label=void 0,this.text=void 0,this.image=void 0,this.audio=void 0,this.location=void 0},Rt=function t(){Object(pt.a)(this,t),this.id=void 0,this.label=void 0,this.targetRoomId=void 0,this.location=void 0},Et=function t(){Object(pt.a)(this,t),this.id=void 0,this.remoteFilePath=void 0,this.extension=void 0},Dt=function t(){Object(pt.a)(this,t),this.id=void 0,this.remoteFilePath=void 0,this.fileName=void 0,this.extension=void 0,this.volume=void 0,this.loop=void 0},Tt=function t(){Object(pt.a)(this,t),this.x=void 0,this.y=void 0},Pt=function(){function t(){Object(pt.a)(this,t),this.projectId=void 0,this.userId=void 0}return Object(mt.a)(t,[{key:"serialize",value:function(t,e){return this.projectId=t.id,this.userId=e,this.serializeProjectData(t)}},{key:"getAssetRemoteFilePath",value:function(t){return"projects/".concat(this.projectId,"/asset-").concat(t.id,".").concat(t.extension)}},{key:"serializeProjectData",value:function(t){var e=new It;return e.id=t.id,e.isPublic=t.isPublic,e.userId=this.userId,e.story=this.serializeStoryData(t.story),e}},{key:"serializeStoryData",value:function(t){var e=this,n=new St;return n.name=t.name,n.tags=t.tags.join(","),t.soundtrack.data&&(n.soundtrack=this.serializeSoundtrackData(t.soundtrack)),t.rooms.forEach((function(t){n.rooms.push(e.serializeRoomData(t))})),n}},{key:"serializeRoomData",value:function(t){var e=this,n=new Nt;return n.id=t.id,n.name=t.name,n.isHome=t.isHome,n.panorama=this.serializeImageAssetData(t.panoramaUrl.backgroundImage),n.thumbnail=this.serializeImageAssetData(t.panoramaUrl.thumbnail),t.backgroundMusic.data&&(n.music=this.serializeSoundtrackData(t.backgroundMusic)),t.backgroundNarration.data&&(n.narration=this.serializeSoundtrackData(t.backgroundNarration)),t.hotspots.forEach((function(t){n.hotspots.push(e.serializeHotspotData(t))})),t.doors.forEach((function(t){n.doors.push(e.serializeDoorData(t))})),n}},{key:"serializeHotspotData",value:function(t){var e=new At;return e.id=t.id,e.label=t.label,e.text=t.text,e.location=this.serializeLocationData(t.location),t.image.data&&(e.image=this.serializeImageAssetData(t.image)),t.audio.data&&(e.audio=this.serializeSoundtrackData(t.audio)),e}},{key:"serializeDoorData",value:function(t){var e=new Rt;return e.id=t.id,e.label=t.label,e.targetRoomId=t.targetRoomId,e.location=this.serializeLocationData(t.location),e}},{key:"serializeImageAssetData",value:function(t){var e=new Et;return e.id=t.id,e.extension=t.extension,e.remoteFilePath=this.getAssetRemoteFilePath(t),e}},{key:"serializeSoundtrackData",value:function(t){var e=new Dt;return e.id=t.id,e.fileName=t.fileName,e.extension=t.extension,e.volume=t.volume,e.remoteFilePath=this.getAssetRemoteFilePath(t),e}},{key:"serializeLocationData",value:function(t){var e=new Tt;return e.x=t.x,e.y=t.y,e}}]),t}(),Ut={apiKey:"AIzaSyDedbwugU4axXQG20TPK63RCBWqMVdc3hA",authDomain:"simplevr-stage.firebaseapp.com",projectId:"simplevr-stage",storageBucket:"simplevr-stage.appspot.com",messagingSenderId:"13689155429",appId:"1:13689155429:web:f362fa80462b5b88e87b8c",measurementId:"G-9TNR7X5YDJ"},Lt=new function t(){var e=this;Object(pt.a)(this,t),this.auth=void 0,this.firestore=void 0,this.storage=void 0,this.currentUser=void 0,this.onUserUpdatedObservers=[],this.signOut=function(){e.auth.signOut()},this.loadUser=function(){var t=Object(b.a)(m.a.mark((function t(n){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.firestore.collection("users").doc(n).get();case 2:if(!(a=t.sent).exists){t.next=5;break}return t.abrupt("return",Object(O.a)({id:a.id},a.data()));case 5:return t.abrupt("return",null);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.createUser=function(){var t=Object(b.a)(m.a.mark((function t(n){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return delete(a=C.a.cloneDeep(n)).id,t.next=4,e.firestore.collection("users").doc(n.id).set(a);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.updateUser=function(){var t=Object(b.a)(m.a.mark((function t(n,a){var o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return delete(o=C.a.cloneDeep(a)).id,t.next=4,e.firestore.collection("users").doc(n).set(o,{merge:!0});case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),this.loadUserStories=function(){var t=Object(b.a)(m.a.mark((function t(n){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=[],t.next=3,e.firestore.collection("projects").where("userId","==",n).get();case 3:return t.sent.forEach((function(t){a.push(t.data())})),t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.loadPublicStories=Object(b.a)(m.a.mark((function t(){var n,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.firestore.collection("projects").where("isPublic","==",!0).get();case 2:return n=t.sent,a=[],n.forEach((function(t){a.push(t.data())})),t.abrupt("return",a);case 6:case"end":return t.stop()}}),t)}))),this.saveProject=function(){var t=Object(b.a)(m.a.mark((function t(n){var a,o,r,i,s,c,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new Pt,o=a.serialize(n,e.currentUser.uid),t.next=4,e.firestore.collection("projects").doc(n.id).set(JSON.parse(JSON.stringify(o)),{merge:!0});case 4:for(r=[],n.story.soundtrack.data&&r.push(e.uploadFileFromDataUrl(a.getAssetRemoteFilePath(n.story.soundtrack),n.story.soundtrack.data)),i=0;i<n.story.rooms.length;i+=1)for(s=n.story.rooms[i],r.push(e.uploadFileFromDataUrl(a.getAssetRemoteFilePath(s.panoramaUrl.backgroundImage),s.panoramaUrl.backgroundImage.data)),r.push(e.uploadFileFromDataUrl(a.getAssetRemoteFilePath(s.panoramaUrl.thumbnail),s.panoramaUrl.thumbnail.data)),r.push(e.uploadFileFromDataUrl(a.getAssetRemoteFilePath(s.backgroundMusic),s.backgroundMusic.data)),r.push(e.uploadFileFromDataUrl(a.getAssetRemoteFilePath(s.backgroundNarration),s.backgroundNarration.data)),c=0;c<s.hotspots.length;c++)u=s.hotspots[c],r.push(e.uploadFileFromDataUrl(a.getAssetRemoteFilePath(u.image),u.image.data)),r.push(e.uploadFileFromDataUrl(a.getAssetRemoteFilePath(u.audio),u.audio.data));return t.next=9,Promise.all(r);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.loadProject=function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=new Ct,t.next=3,n.deserialize(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.loadProjectWithId=function(){var t=Object(b.a)(m.a.mark((function t(n){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.firestore.collection("projects").doc(n).get();case 2:return a=t.sent,t.abrupt("return",a.data());case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),this.updateProjectPublicFlag=function(){var t=Object(b.a)(m.a.mark((function t(n,a){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.firestore.collection("projects").doc(n).update({isPublic:a});case 2:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),this.uploadFileFromDataUrl=function(){var t=Object(b.a)(m.a.mark((function t(n,a){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.storage.ref(n).putString(a,ht.a.storage.StringFormat.DATA_URL);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),this.getDownloadUrl=function(){var t=Object(b.a)(m.a.mark((function t(n){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.storage.ref(n).getDownloadURL());case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ht.a.apps.length||ht.a.initializeApp(Ut),this.auth=ht.a.auth(),this.firestore=ht.a.firestore(),this.storage=ht.a.storage(),ht.a.auth().onAuthStateChanged((function(t){t?(e.currentUser=t,e.onUserUpdatedObservers.map((function(e){return e(t)}))):(e.currentUser=null,e.onUserUpdatedObservers.map((function(t){return t(null)})))}))},Ft=o.a.createContext(Lt),zt=n(1),_t=Object(f.a)((function(){return{signInButton:{borderRadius:"24px",height:"48px"},menuListItem:{paddingTop:"1rem",paddingBottom:"1rem",textAlign:"center"},avatar:function(t){return{border:"solid 2px ".concat(t.userColor)}},avatarInitialsOnly:function(t){return{backgroundColor:t.userColor,color:"#FFFFFF"}},userDisplayName:{marginTop:0,marginBottom:"0rem",paddingTop:"1rem",marginLeft:"1rem",marginRight:"1rem"},userEmail:{marginLeft:"1rem",marginRight:"1rem",marginTop:0,fontWeight:500}}}));var Mt=Object(s.b)((function(t){return{userProp:t.user}}),{setIsShowingSignInDialogProp:st,setUserProp:it})((function(t){var e=t.setIsShowingSignInDialogProp,n=t.setUserProp,o=t.userProp,r=_t(),i=Object(a.useContext)(Ft),s=Object(a.useRef)(),c=Object(a.useState)(!1),u=Object(w.a)(c,2),l=u[0],d=u[1];Object(a.useEffect)((function(){i.onUserUpdatedObservers.push(function(){var t=Object(b.a)(m.a.mark((function t(e){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(C.a.isNil(e)){t.next=5;break}return t.next=3,i.loadUser(e.uid);case 3:a=t.sent,C.a.isNil(a)||n(a);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[]);var p=function(t){s.current&&s.current.contains(t.target)||d(!1)};function h(t){"Tab"===t.key&&(t.preventDefault(),d(!1))}var f=function(){i.signOut(),n(null)};return Object(zt.jsxs)(zt.Fragment,{children:[!o&&Object(zt.jsx)(v.a,{className:r.signInButton,variant:"contained",color:"primary",disableElevation:!0,size:"large",onClick:function(){e(!0)},children:Object(zt.jsx)(x.a,{variant:"h2",children:"Sign in"})}),o&&Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsxs)(I.a,{ref:s,"aria-controls":l?"menu-list-grow":void 0,"aria-haspopup":"true",onClick:function(){d((function(t){return!t}))},children:[!C.a.isNil(o.avatar)&&Object(zt.jsx)(S.a,{className:r.avatar,alt:o.displayName,src:o.avatar}),C.a.isNil(o.avatar)&&Object(zt.jsx)(S.a,{className:r.avatarInitialsOnly,alt:o.displayName})]}),Object(zt.jsx)(N.a,{open:l,anchorEl:s.current,role:void 0,transition:!0,disablePortal:!0,children:function(t){var e=t.TransitionProps,n=t.placement;return Object(zt.jsx)(A.a,Object(O.a)(Object(O.a)({},e),{},{style:{transformOrigin:"bottom"===n?"center top":"center bottom"},children:Object(zt.jsx)(R.a,{size:"md",children:Object(zt.jsx)(E.a,{onClickAway:p,children:Object(zt.jsxs)(g.a,{children:[Object(zt.jsx)("h2",{className:r.userDisplayName,children:o.displayName}),Object(zt.jsx)("h3",{className:r.userEmail,children:o.email}),Object(zt.jsx)(y.a,{}),Object(zt.jsx)(D.a,{autoFocusItem:l,id:"menu-list-grow",onKeyDown:h,children:Object(zt.jsx)(T.a,{onClick:f,className:r.menuListItem,children:"Sign out"})})]})})})}))}})]})]})})),Bt=Object(f.a)((function(t){return{root:{height:"96px",width:"100%",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},signInButton:{borderRadius:"24px",height:"48px"},infoButton:{backgroundColor:"rgba(0,0,0,0.6)",padding:0,"&:hover":{backgroundColor:"rgba(0,0,0,0.4)"},borderRadius:"24px"},infoButtonLogo:{paddingRight:12,paddingLeft:22},infoButtonInfoIcon:{paddingRight:22,paddingLeft:12},divider:{height:48,color:"white",backgroundColor:"rgba(255, 255, 255, 0.2)"},paper:{marginRight:t.spacing(2),borderRadius:"16px"},colorPicker:{padding:"1rem"},menuList:{},menuListItem:{paddingTop:"1rem",paddingBottom:"1rem",textAlign:"center"},avatar:function(t){return{border:"solid 2px ".concat(t.userColor)}},avatarInitialsOnly:function(t){return{backgroundColor:t.userColor,color:"#FFFFFF"}},userDisplayName:{marginTop:0,marginBottom:"0rem",paddingTop:"1rem",marginLeft:"1rem",marginRight:"1rem"},userEmail:{marginLeft:"1rem",marginRight:"1rem",marginTop:0,fontWeight:500}}}));function Ht(){var t=Bt();return Object(zt.jsx)(j.a,{maxWidth:"md",children:Object(zt.jsxs)(g.a,{className:t.root,children:[Object(zt.jsxs)(v.a,{className:t.infoButton,disableElevation:!0,size:"large",variant:"contained",children:[Object(zt.jsx)("img",{className:t.infoButtonLogo,src:"/logo.svg",alt:"logo"}),Object(zt.jsx)(y.a,{className:t.divider,orientation:"vertical",flexItem:!0}),Object(zt.jsx)("img",{className:t.infoButtonInfoIcon,src:"/icons/info.svg",alt:"info"})]}),Object(zt.jsx)(Mt,{})]})})}var Wt=n(92),qt=n.n(Wt),Yt=n(246),Xt=n(262),$t=n(264),Gt=Object(f.a)({title:{textAlign:"center"},body:{padding:"1rem",borderTop:"solid 1px rgba(255,255,255,0.1)"},button:{marginBottom:"1rem",textAlign:"center"},emailForm:{display:"flex",flexDirection:"column"},emailFormItem:{marginBottom:"1rem",minWidth:"300px"},signUpButton:{fontWeight:600},backButton:{position:"absolute",left:4,top:8},error:{textAlign:"center",marginBottom:"2rem",fontWeight:600}}),Vt=Object(s.b)((function(t){return{user:t.user,isShowingSignInDialog:t.display.isShowingSignInDialog}}),{setIsShowingSignInDialogAction:st,setUserAction:it})((function(t){var e=t.isShowingSignInDialog,n=t.setIsShowingSignInDialogAction,o=t.setUserAction,r=Gt(),i=Object(a.useContext)(Ft),s=Object(a.useState)(!1),c=Object(w.a)(s,2),u=c[0],l=c[1],d=Object(a.useState)(!1),p=Object(w.a)(d,2),h=p[0],f=p[1],j=Object(a.useState)(!1),x=Object(w.a)(j,2),y=x[0],O=x[1],k=Object(a.useState)(null),S=Object(w.a)(k,2),N=S[0],A=S[1],R=Object(a.useRef)(),E=Object(a.useRef)(),D=Object(a.useRef)(),T=Object(a.useRef)(),P=Object(a.useRef)(),U=Object(a.useRef)(),L=function(){l(!1),O(!1),A(null),n(!1),f(!1)},F=function(){var t=Object(b.a)(m.a.mark((function t(){var e,n,a,o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return L(),e=new ht.a.auth.GoogleAuthProvider,t.next=4,i.auth.signInWithPopup(e);case 4:return n=t.sent,a=n.user,t.next=8,i.loadUser(a.uid);case 8:if(o=t.sent,!C.a.isNil(o)){t.next=13;break}return o={displayName:a.displayName,email:a.email,avatar:a.photoURL,id:a.uid,isGuest:!1},t.next=13,i.createUser(o);case 13:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),z=function(){var t=Object(b.a)(m.a.mark((function t(){var e,n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=R.current.querySelectorAll("input")[0].value,n=D.current.querySelectorAll("input")[0].value,t.prev=2,t.next=5,i.auth.signInWithEmailAndPassword(e,n);case 5:L(),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(2),A(t.t0.message);case 11:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(){return t.apply(this,arguments)}}(),_=function(){var t=Object(b.a)(m.a.mark((function t(){var e,n,a,r,s,c;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=E.current.querySelectorAll("input")[0].value,n=T.current.querySelectorAll("input")[0].value,a=P.current.querySelectorAll("input")[0].value,C.a.isEmpty(a)){t.next=21;break}return t.prev=4,t.next=7,i.auth.createUserWithEmailAndPassword(e,n);case 7:return r=t.sent,s=r.user,c={displayName:a,email:e,id:s.uid,isGuest:!1},t.next=12,i.createUser(c);case 12:o(c),L(),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(4),A(t.t0.message);case 19:t.next=22;break;case 21:A("Please enter a name");case 22:case"end":return t.stop()}}),t,null,[[4,16]])})));return function(){return t.apply(this,arguments)}}(),M=function(){var t=Object(b.a)(m.a.mark((function t(){var e,n,a,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=U.current.querySelectorAll("input")[0].value,C.a.isEmpty(e)){t.next=19;break}return t.prev=2,t.next=5,i.auth.signInAnonymously();case 5:return n=t.sent,a=n.user,r={isGuest:!0,displayName:e,id:a.uid},t.next=10,i.createUser(r);case 10:o(r),L(),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(2),A(t.t0.message);case 17:t.next=20;break;case 19:A("Please enter a name");case 20:case"end":return t.stop()}}),t,null,[[2,14]])})));return function(){return t.apply(this,arguments)}}(),B=function(){l(!1),O(!1),A(null),f(!1)};return Object(zt.jsx)(zt.Fragment,{children:Object(zt.jsxs)(Xt.a,{onClose:L,"aria-labelledby":"simple-dialog-title",open:e,children:[!u&&!y&&!h&&Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsx)(Yt.a,{className:r.title,id:"simple-dialog-title",children:"Sign in"}),Object(zt.jsxs)(g.a,{className:r.body,children:[Object(zt.jsx)(v.a,{className:r.button,fullWidth:!0,color:"secondary",variant:"contained",disableElevation:!0,onClick:F,children:"Continue with Google"}),Object(zt.jsx)(v.a,{className:r.button,fullWidth:!0,color:"secondary",variant:"contained",disableElevation:!0,onClick:function(){l(!0)},children:"Sign in with email"}),Object(zt.jsx)(v.a,{className:r.button,fullWidth:!0,color:"secondary",variant:"contained",disableElevation:!0,onClick:function(){f(!0)},children:"Use as guest"}),Object(zt.jsx)("p",{style:{textAlign:"center"},children:"Don't have an account yet?"}),Object(zt.jsx)(v.a,{className:r.signUpButton,fullWidth:!0,disableElevation:!0,onClick:function(){l(!1),O(!0),f(!1)},children:"Sign up"})]})]}),u&&Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsxs)(Yt.a,{className:r.title,id:"simple-dialog-title",children:[Object(zt.jsx)(I.a,{"aria-label":"close",className:r.backButton,onClick:B,children:Object(zt.jsx)(qt.a,{})}),"Sign in with email"]}),Object(zt.jsx)(g.a,{className:r.body,children:Object(zt.jsxs)("form",{className:r.emailForm,noValidate:!0,autoComplete:"off",children:[Object(zt.jsx)($t.a,{type:"email",ref:R,className:r.emailFormItem,label:"Email address",variant:"outlined"}),Object(zt.jsx)($t.a,{ref:D,className:r.emailFormItem,label:"Password",variant:"outlined",type:"password"}),N&&Object(zt.jsx)("p",{className:r.error,children:N}),Object(zt.jsx)(v.a,{className:r.button,fullWidth:!0,color:"primary",variant:"contained",disableElevation:!0,onClick:z,children:Object(zt.jsx)("strong",{children:"Sign in"})})]})})]}),h&&Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsxs)(Yt.a,{className:r.title,id:"simple-dialog-title",children:[Object(zt.jsx)(I.a,{"aria-label":"close",className:r.backButton,onClick:B,children:Object(zt.jsx)(qt.a,{})}),"Continue as guest"]}),Object(zt.jsx)(g.a,{className:r.body,children:Object(zt.jsxs)("form",{className:r.emailForm,noValidate:!0,autoComplete:"off",children:[Object(zt.jsx)($t.a,{ref:U,className:r.emailFormItem,label:"Name",variant:"outlined"}),N&&Object(zt.jsx)("p",{className:r.error,children:N}),Object(zt.jsx)(v.a,{className:r.button,fullWidth:!0,color:"primary",variant:"contained",disableElevation:!0,onClick:M,children:Object(zt.jsx)("strong",{children:"Continue as guest"})})]})})]}),y&&Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsxs)(Yt.a,{className:r.title,id:"simple-dialog-title",children:[Object(zt.jsx)(I.a,{"aria-label":"close",className:r.backButton,onClick:B,children:Object(zt.jsx)(qt.a,{})}),"Sign up with email"]}),Object(zt.jsx)(g.a,{className:r.body,children:Object(zt.jsxs)("form",{className:r.emailForm,noValidate:!0,autoComplete:"off",children:[Object(zt.jsx)($t.a,{ref:P,className:r.emailFormItem,label:"Name",variant:"outlined"}),Object(zt.jsx)($t.a,{type:"email",ref:E,className:r.emailFormItem,label:"Email address",variant:"outlined"}),Object(zt.jsx)($t.a,{ref:T,className:r.emailFormItem,label:"Password",variant:"outlined",type:"password"}),N&&Object(zt.jsx)("p",{className:r.error,children:N}),Object(zt.jsx)(v.a,{className:r.button,fullWidth:!0,color:"primary",variant:"contained",disableElevation:!0,onClick:_,children:Object(zt.jsx)("strong",{children:"Sign up"})})]})})]})]})})})),Jt=n(89),Kt=n.n(Jt),Zt=n(122),Qt=n.n(Zt),te=function(){function t(){Object(pt.a)(this,t),this.zip=new Kt.a}return Object(mt.a)(t,[{key:"create",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.storeProjectData(e);case 2:return t.next=4,this.zip.generateAsync({type:"blob"});case 4:n=t.sent,Qt()(n,e.story.name);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"storeProjectData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.zip.file("project-data.json",JSON.stringify(e)),t.next=3,this.storeStoryData(e.story);case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"storeStoryData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n,a=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],e.soundtrack&&n.push(this.storeAsset(e.soundtrack)),e.rooms.forEach((function(t){n.push(a.storeRoomData(t))})),t.next=5,Promise.all(n);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"storeRoomData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n,a=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=[]).push(this.storeAsset(e.panorama)),n.push(this.storeAsset(e.thumbnail)),e.music&&n.push(this.storeAsset(e.music)),e.narration&&n.push(this.storeAsset(e.narration)),e.hotspots.forEach((function(t){n.push(a.storeHotspotData(t))})),t.next=8,Promise.all(n);case 8:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"storeHotspotData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],e.image&&n.push(this.storeAsset(e.image)),e.audio&&n.push(this.storeAsset(e.audio)),t.next=5,Promise.all(n);case 5:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"storeAsset",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetchRemoteAssetFileData(e.remoteFilePath);case 2:n=t.sent,this.zip.file("".concat(e.id,".").concat(e.extension),n,{base64:!0});case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"fetchRemoteAssetFileData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Lt.getDownloadUrl(e);case 2:return n=t.sent,t.abrupt("return",new Promise((function(t){var e=new XMLHttpRequest;e.onload=function(){var n=new FileReader;n.onload=function(){if("string"===typeof n.result){var e=n.result.replace(/^data:.+;base64,/,"");t(e)}},n.readAsDataURL(e.response)},e.open("GET",n),e.responseType="blob",e.send()})));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),ee=n(123),ne=n.n(ee),ae=n(124),oe=n.n(ae),re=n(251),ie=n(267),se=n(250),ce=Object(f.a)((function(){return{root:{padding:"0px"},contentRoot:{padding:"0px 0px 16px 0px"},titleContainer:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",height:"48px"},closeIcon:{position:"absolute"},storyInfoContainer:{display:"flex",alignItems:"center",paddingLeft:"24px",justifyContent:"space-between",backgroundColor:"rgba(0, 0, 0, 0.1)",borderBottom:"1px solid rgba(0, 0, 0, 0.1)",borderTop:"1px solid rgba(0, 0, 0, 0.1)",boxSizing:"content-box"},storyNameInfo:{display:"flex",flexDirection:"column"},storyPublicInfo:{display:"flex"},storyRoomInfo:{display:"flex",flexDirection:"column",justifyContent:"center",borderLeft:"1px solid rgba(0, 0, 0, 0.1)"},storyDialogThumbnailImage:{width:"80px",height:"40px",backgroundPosition:"center",backgroundSize:"cover"},shareStoryPublicToggle:{display:"flex",alignItems:"center",justifyContent:"space-between",height:"48px",marginTop:"12px",marginLeft:"24px",marginRight:"24px",boxSizing:"content-box"},shareStoryPublicToggleText:{display:"flex"},publicStoryInfo:{paddingLeft:"24px",paddingRight:"24px",paddingTop:"8px"},publicDataContainer:{display:"flex",flexDirection:"column",alignItems:"center",paddingTop:"12px",paddingLeft:"24px",paddingRight:"24px",paddingBottom:"24px"}}}));function ue(t){var e=t.thumbnailUrl,n=t.project,o=t.onClose,r=ce(),i=Object(a.useContext)(Ft),s=Object(a.useState)(""),c=Object(w.a)(s,2),u=c[0],l=c[1],d=Object(a.useState)(n.isPublic),p=Object(w.a)(d,2),h=p[0],f=p[1],j=function(t){O.current&&ne.a.toCanvas(O.current,t)},y=function(){var t=Object(b.a)(m.a.mark((function t(){var e;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e="".concat(window.location.origin,"/view/").concat(n.id),l(e),j(e);case 3:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),O=Object(a.useCallback)((function(t){O.current=t,t&&h&&y()}),[]);Object(a.useEffect)(Object(b.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return h&&y(),t.next=3,i.updateProjectPublicFlag(n.id,h);case 3:n.isPublic=h;case 4:case"end":return t.stop()}}),t)}))),[h]);var k=function(){var t=Object(b.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:f(!h);case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),C=h?"public-story-icon.svg":"private-story-icon.svg";return Object(zt.jsxs)(Xt.a,{onClose:o,open:!0,maxWidth:"xs",fullWidth:!0,children:[Object(zt.jsxs)(Yt.a,{className:r.root,children:[Object(zt.jsx)(I.a,{onClick:o,className:r.closeIcon,children:Object(zt.jsx)(se.a,{})}),Object(zt.jsx)("div",{className:r.titleContainer,children:Object(zt.jsx)(x.a,{variant:"body1",children:"Share story"})})]}),Object(zt.jsxs)(re.a,{className:r.contentRoot,children:[Object(zt.jsxs)("div",{className:r.storyInfoContainer,children:[Object(zt.jsxs)("div",{className:r.storyNameInfo,children:[Object(zt.jsx)(x.a,{variant:"body2",children:n.story.name}),Object(zt.jsx)(g.a,{m:.5}),Object(zt.jsxs)("div",{className:r.storyPublicInfo,children:[Object(zt.jsx)("img",{src:"/icons/".concat(C),alt:"public-story-icon"}),Object(zt.jsx)(g.a,{m:.3}),Object(zt.jsx)(x.a,{variant:"caption",children:h?"Public story":"Only visible to you"})]})]}),Object(zt.jsxs)("div",{className:r.storyRoomInfo,children:[Object(zt.jsx)("div",{className:r.storyDialogThumbnailImage,style:{backgroundImage:"url(".concat(e,")")}}),Object(zt.jsx)(g.a,{m:.5}),Object(zt.jsxs)(x.a,{variant:"caption",children:[1," rooms"]})]})]}),Object(zt.jsxs)("div",{className:r.shareStoryPublicToggle,children:[Object(zt.jsxs)("div",{className:r.shareStoryPublicToggleText,children:[Object(zt.jsx)("img",{src:"/icons/public-story-icon.svg",alt:"make-story-public"}),Object(zt.jsx)(g.a,{m:.3}),Object(zt.jsx)(x.a,{variant:"body1",children:"Make public"})]}),Object(zt.jsx)(ie.a,{checked:h,onChange:k})]}),Object(zt.jsx)("div",{className:r.publicStoryInfo,children:Object(zt.jsx)(x.a,{variant:"caption",children:"Public stories can be searched and viewed with a link. Only you can edit your stories."})}),h&&Object(zt.jsxs)("div",{className:r.publicDataContainer,children:[Object(zt.jsx)("canvas",{ref:O}),Object(zt.jsx)(x.a,{variant:"body2",align:"center",children:u}),Object(zt.jsx)(g.a,{m:2}),Object(zt.jsx)(v.a,{fullWidth:!0,variant:"outlined",onClick:function(){oe()(u)},children:"Copy link"})]})]})]})}var le=Object(f.a)((function(){return{projectCardContainer:{width:"100%",backgroundColor:"white",display:"flex",flexDirection:"column",boxShadow:"0px 1px 1px rgba(0, 0, 0, 0.08), -1px 0px 1px rgba(0, 0, 0, 0.08), 1px 0px 1px rgba(0, 0, 0, 0.08), 0px -1px 1px rgba(0, 0, 0, 0.08)",borderRadius:"12px",height:"200px"},projectCardHeader:{display:"flex",alignItems:"center",justifyContent:"space-between"},projectCardTitle:{display:"flex",flexDirection:"column",padding:"12px"},title:{whiteSpace:"nowrap",textOverflow:"ellipsis",width:"95px",overflow:"hidden"},cardActionsContainer:{display:"flex",height:"48px"},storyCardImageContainer:{borderRadius:"0px 0px 12px 12px",display:"flex",position:"relative",height:"100%"},storyCardImage:{width:"100%",height:"100%",borderRadius:"0px 0px 12px 12px",backgroundSize:"cover",backgroundPosition:"center"},storyCardOptions:{position:"absolute",display:"flex",justifyContent:"center",alignItems:"center",left:"0px",top:"0px",width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.9)",borderRadius:"0px 0px 12px 12px"}}}));var de=Object(s.b)((function(){return{}}),{setProjectAction:ct,setStoryAction:ut,setCurrentRoomAction:lt})((function(t){var e=t.project,n=t.isPublic,o=t.setProjectAction,r=t.setStoryAction,i=t.setCurrentRoomAction,s=le(),c=Object(a.useContext)(Ft),l=Object(u.f)(),d=Object(a.useState)(!1),p=Object(w.a)(d,2),h=(p[0],p[1]),f=Object(a.useState)(""),j=Object(w.a)(f,2),g=j[0],v=j[1],y=Object(a.useState)(!1),O=Object(w.a)(y,2),k=O[0],C=O[1];Object(a.useEffect)(Object(b.a)(m.a.mark((function t(){var n,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=A(e.story.rooms),t.next=3,c.getDownloadUrl(n.thumbnail.remoteFilePath);case 3:a=t.sent,v(a);case 5:case"end":return t.stop()}}),t)}))),[]);var S=function(){var t=Object(b.a)(m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.loadProject(e);case 2:n=t.sent,o(n),r(n.story),i(n.story.rooms[0]),l.push("/editor");case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),N=function(){var t=Object(b.a)(m.a.mark((function t(){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.loadProject(e);case 2:n=t.sent,o(n),r(n.story),i(n.story.rooms[0]),l.push("/view/".concat(e.id));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),A=function(t){var e=t.find((function(t){return t.isHome}));return e||(e=t[0]),e},R=function(){var t=Object(b.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:(new te).create(e);case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(zt.jsxs)("div",{className:s.projectCardContainer,onMouseEnter:function(){n||h(!0)},onMouseLeave:function(){n||h(!1)},onClick:function(){n&&N()},style:{cursor:n?"pointer":"default"},children:[Object(zt.jsxs)("div",{className:s.projectCardHeader,children:[Object(zt.jsxs)("div",{className:s.projectCardTitle,children:[Object(zt.jsx)(x.a,{variant:"body2",className:s.title,children:e.story.name}),Object(zt.jsxs)(x.a,{variant:"caption",children:["Tags:",e.story.tags||"n/a"]})]}),Object(zt.jsxs)("div",{className:s.cardActionsContainer,children:[!n&&Object(zt.jsx)(I.a,{onClick:S,children:Object(zt.jsx)("img",{src:"/icons/edit-icon.svg",alt:"edit"})}),!n&&Object(zt.jsx)(I.a,{onClick:function(){C(!0),h(!1)},children:Object(zt.jsx)("img",{src:"/icons/share-icon.svg",alt:"share"})}),!n&&Object(zt.jsx)(I.a,{onClick:R,children:Object(zt.jsx)("img",{src:"/icons/share-icon.svg",alt:"share"})})]})]}),Object(zt.jsx)("div",{className:s.storyCardImageContainer,children:g&&Object(zt.jsx)("div",{className:s.storyCardImage,style:{backgroundImage:"url(".concat(g,")")}})}),k&&Object(zt.jsx)(ue,{onClose:function(){C(!1)},thumbnailUrl:g,project:e})]})})),pe=Object(f.a)((function(){return{container:{paddingTop:"48px"},signInContent:{display:"flex",alignItems:"center",flexDirection:"column",width:"100%",marginTop:"12px"},placeholderImage:{paddingBottom:"24px"},signInButton:{marginTop:"12px",height:"48px",borderRadius:"24px"},userStoriesSignedInContent:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gridGap:"12px",width:"100%"}}}));var he=Object(s.b)((function(t){return{user:t.user,userStories:t.userStories}}),{setUserStoriesAction:function(t){return{type:F,payload:{value:t}}},setIsShowingSignInDialogAction:st})((function(t){var e=t.user,n=t.userStories,o=t.setUserStoriesAction,r=t.setIsShowingSignInDialogAction,i=Object(a.useContext)(Ft),s=pe();return Object(a.useEffect)((function(){i.onUserUpdatedObservers.push(function(){var t=Object(b.a)(m.a.mark((function t(e){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:C.a.isNil(e)||i.loadUserStories(e.uid).then((function(t){o(t)}));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[]),Object(zt.jsxs)(j.a,{maxWidth:"md",className:s.container,children:[!e&&Object(zt.jsxs)("div",{children:[Object(zt.jsx)(x.a,{variant:"body1",className:"light-text-90",children:"Your stories"}),Object(zt.jsxs)("div",{className:s.signInContent,children:[Object(zt.jsx)("img",{src:"images/user-stories-placeholder.svg",alt:"user story placeholder",className:s.placeholderImage}),Object(zt.jsx)(x.a,{variant:"body1",className:"light-text-70",children:"To see your stories, please sign in"}),Object(zt.jsx)(v.a,{variant:"contained",color:"primary",size:"large",className:s.signInButton,disableElevation:!0,onClick:function(){r(!0)},children:Object(zt.jsx)(x.a,{variant:"h2",children:"Sign in"})})]})]}),e&&Object(zt.jsxs)("div",{children:[Object(zt.jsxs)(x.a,{variant:"body1",className:"light-text-90",children:["Your stories (",n.length,")"]}),Object(zt.jsx)(g.a,{m:2}),Object(zt.jsx)("div",{className:s.userStoriesSignedInContent,children:n.map((function(t){return Object(zt.jsx)(de,{project:t},t.id)}))})]}),!1]})})),me=Object(f.a)((function(){return{container:{paddingTop:"48px"},showMoreContainer:{display:"flex",justifyContent:"center",width:"100%",paddingTop:"12px"},seeMoreButton:{borderRadius:"24px",height:"48px"},userStoriesSignedInContent:{marginTop:"12px",marginBottom:"24px",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gridGap:"12px",width:"100%"}}})),be={setPublicStoriesAction:function(t){return{type:z,payload:{value:t}}}},fe=Object(s.b)((function(t){return{publicStories:t.publicStories}}),be)((function(t){var e=t.publicStories,n=t.setPublicStoriesAction,o=Object(a.useContext)(Ft),r=me();return Object(a.useEffect)((function(){o.loadPublicStories().then((function(t){n(t)}))}),[]),Object(zt.jsx)(j.a,{maxWidth:"md",className:r.container,children:Object(zt.jsxs)("div",{children:[Object(zt.jsx)(x.a,{variant:"body1",className:"light-text-90",children:"Explore public stories"}),Object(zt.jsx)(x.a,{variant:"body2",className:"light-text-70",children:"Explore public stories"}),Object(zt.jsx)("div",{className:r.userStoriesSignedInContent,children:e.map((function(t){return Object(zt.jsx)(de,{project:t,isPublic:!0},t.id)}))})]})})})),je=Object(f.a)((function(){return{input:{display:"none"},container:{position:"relative"},dropZone:{position:"absolute",left:0,right:0,top:0,bottom:0,cursor:"pointer"}}})),ge=function(t){var e=t.children,n=t.onChange,o=je(),r=Object(a.useRef)();return Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsx)("input",{type:"file",className:o.input,ref:r,onChange:function(t){var e=t.target.files&&t.target.files[0];n(e)},style:{display:"none"}}),Object(zt.jsxs)("div",{className:o.container,children:[e,Object(zt.jsx)("div",{onClick:function(){r.current.click()},onDragOver:function(t){t.preventDefault()},onDrop:function(t){t.preventDefault();var e=t.dataTransfer.files&&t.dataTransfer.files[0];n(e)},className:o.dropZone})]})]})},xe="image/jpeg",ve={video:["video/mp4"],audio:["audio/mp3","audio/wav","audio/mpeg","audio/x-wav","audio/aac","audio/x-m4a"],image:["image/png","image/jpg",xe],zip:["application/zip","application/x-zip","application/octet-stream","application/x-zip-compressed"]},ye=function(){function t(){Object(pt.a)(this,t)}return Object(mt.a)(t,null,[{key:"validateFileLoadEvent",value:function(t,e){return new Promise((function(n,a){(ve[e]||a(new Error("Accepted file type not valid")),ve[e].indexOf(t.type)<0)&&a("File is not a valid type, must be of type: ".concat(e,".\n")+"Accepted file types: ".concat(ve[e].join(", ")));n(t)}))}},{key:"isFileOfType",value:function(t,e){return!!ve[e]&&ve[e].indexOf(t.type)>0}},{key:"getBinaryFileData",value:function(t){return new Promise((function(e,n){var a=new FileReader;a.onloadend=function(){e(a.result)},a.onerror=function(){var t=a.error;n(t)},a.readAsDataURL(t)}))}}]),t}();function Oe(t){return new Array(14).fill(null).map((function(t,e){return Math.pow(2,e)})).map((function(e){return{distance:Math.abs(t-e),value:e}})).sort((function(t,e){return t.distance-e.distance}))[0].value}function we(t,e,n){var a,o;return t>e&&t>n?(a=n,o=e/t*n):e>t&&e>n?(a=t/e*n,o=n):t===e&&t>n?(a=n,o=n):(a=t,o=e),new Ot(a,o)}var ke={projectThumbnail:function(){return new Ot(336,168)},hotspotImage:function(t,e){return we(t,e,1024)},backgroundImage:function(t,e){if(t>=e){var n=Oe(t),a=Math.floor(e/t*n);return new Ot(n,a)}var o=Oe(e),r=Math.floor(t/e*o);return new Ot(r,o)}};function Ce(t,e){return new Promise((function(n,a){try{var o=document.createElement("canvas"),r=new Image;r.crossOrigin="anonymous",r.onload=function(){var t=ke[e](r.width,r.height);o.width=t.getX(),o.height=t.getY(),o.getContext("2d").drawImage(r,0,0,r.width,r.height,0,0,t.getX(),t.getY()),n(o.toDataURL(xe,.8))},r.src=t}catch(i){a(i)}}))}function Ie(t,e){return Se.apply(this,arguments)}function Se(){return(Se=Object(b.a)(m.a.mark((function t(e,n){var a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ke[n]){t.next=2;break}return t.abrupt("return",Promise.reject(new Error("resizeImage must have a valid size option: ".concat(Object.keys(ke).join(", ")))));case 2:if("backgroundImage"!==n){t.next=7;break}return t.next=5,Promise.all([Ce(e,"backgroundImage"),Ce(e,"projectThumbnail")]);case 5:return a=t.sent,t.abrupt("return",{backgroundImage:a[0],thumbnail:a[1]});case 7:return t.abrupt("return",Ce(e,n));case 8:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var Ne=n(36),Ae=n.n(Ne),Re=function(){function t(){Object(pt.a)(this,t),this.zip=void 0,this.project=void 0}return Object(mt.a)(t,[{key:"load",value:function(){var t=Object(b.a)(m.a.mark((function t(e){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Kt.a.loadAsync(e);case 2:return this.zip=t.sent,t.next=5,this.loadProjectData();case 5:return t.abrupt("return",this.project);case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadProjectData",value:function(){var t=Object(b.a)(m.a.mark((function t(){var e,n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.zip.file("project-data.json").async("text");case 2:return e=t.sent,n=new Ct,t.next=6,n.deserialize(JSON.parse(e));case 6:this.project=t.sent,this.loadStoryData(this.project.story);case 8:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"loadStoryData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadAssetData(e.soundtrack);case 2:e.soundtrack.data=t.sent,e.rooms.forEach((function(t){n.loadRoomData(t)}));case 4:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadRoomData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n=this;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadAssetData(e.panoramaUrl.backgroundImage);case 2:return e.panoramaUrl.backgroundImage.data=t.sent,t.next=5,this.loadAssetData(e.panoramaUrl.thumbnail);case 5:return e.panoramaUrl.thumbnail.data=t.sent,t.next=8,this.loadAssetData(e.backgroundMusic);case 8:return e.backgroundMusic.data=t.sent,t.next=11,this.loadAssetData(e.backgroundNarration);case 11:e.backgroundNarration.data=t.sent,e.hotspots.forEach((function(t){n.loadHotspotData(t)}));case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadHotspotData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadAssetData(e.image);case 2:return e.image.data=t.sent,t.next=5,this.loadAssetData(e.audio);case 5:e.audio.data=t.sent;case 6:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()},{key:"loadAssetData",value:function(){var t=Object(b.a)(m.a.mark((function t(e){var n,a,o,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("boolean"!==typeof(n=Ae.a.contentType(e.extension))){t.next=3;break}return t.abrupt("return");case 3:if(a=this.zip.file("".concat(e.id,".").concat(e.extension))){t.next=6;break}return t.abrupt("return");case 6:return t.next=8,a.async("blob");case 8:return o=t.sent,r=new Blob([o],{type:n}),t.abrupt("return",new Promise((function(t){var e=new FileReader;e.onload=function(){t(e.result)},e.readAsDataURL(r)})));case 11:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}()}]),t}(),Ee=Object(f.a)((function(t){return{hero:{backgroundColor:t.palette.secondary.main,padding:"32px 64px",borderRadius:"24px",textAlign:"center"},uploadButton:{padding:"24px 48px",border:"2px dashed #e34b78",borderRadius:"60px",boxSizing:"content-box",fontSize:"20px",fontWeight:600,marginTop:"32px"},uploadButtonContent:{display:"flex",flexDirection:"column"},input:{display:"none"}}}));var De=Object(s.b)((function(){return{}}),{setProjectAction:ct,setStoryAction:ut,setCurrentRoomAction:lt})((function(t){var e=t.setProjectAction,n=t.setStoryAction,o=t.setCurrentRoomAction,r=Ee(),i=Object(a.useRef)(),s=Object(u.f)(),c=function(){var t=Object(b.a)(m.a.mark((function t(a){var r,i,c,u;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("application/zip"!==a.type){t.next=3;break}return l(a),t.abrupt("return");case 3:return t.next=5,ye.validateFileLoadEvent(a,"image");case 5:return t.next=7,ye.getBinaryFileData(a);case 7:return r=t.sent,t.next=10,Ie(r,"backgroundImage");case 10:i=t.sent,c=new gt,(u=new vt).panoramaUrl.backgroundImage.data=i.backgroundImage,u.panoramaUrl.backgroundImage.extension="jpeg",u.panoramaUrl.thumbnail.data=i.thumbnail,u.panoramaUrl.thumbnail.extension="jpeg",c.story.rooms.push(u),e(c),n(c.story),o(u),s.push("/editor");case 22:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),l=function(){var t=Object(b.a)(m.a.mark((function t(a){var r,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new Re,t.next=3,r.load(a);case 3:i=t.sent,e(i),n(i.story),o(i.story.rooms[0]),s.push("/editor");case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsx)(Ht,{}),Object(zt.jsx)(j.a,{maxWidth:"md",children:Object(zt.jsxs)(g.a,{className:r.hero,children:[Object(zt.jsx)(x.a,{variant:"body1",className:"light-text",children:"Start creating your immersive story by combining 360 photos with audio recordings, images, and text"}),Object(zt.jsx)("input",{id:"welcome-message-input",type:"file",className:r.input,ref:i,onChange:function(t){var e=t.target.files&&t.target.files[0];c(e)}}),Object(zt.jsx)(ge,{onChange:c,children:Object(zt.jsx)(v.a,{className:r.uploadButton,size:"large",color:"primary",onClick:function(){i.current.click()},children:Object(zt.jsxs)("div",{className:r.uploadButtonContent,children:[Object(zt.jsx)(x.a,{variant:"h1",children:"Upload 360\xb0 panorama image"}),Object(zt.jsx)(x.a,{variant:"h2",children:"or a story .zip"})]})})})]})}),Object(zt.jsx)(he,{}),Object(zt.jsx)(fe,{}),Object(zt.jsx)(Vt,{})]})}));function Te(t,e){var n=[];return t.image.data&&n.push("image"),t.text&&n.push("text"),t.audio.data&&n.push("audio"),"icon-".concat(n.length>0?n.join("-"):"add",".").concat(e||"png")}function Pe(){return 10*(Math.random()>.5?-1:1)*Math.random()}var Ue=function(){function t(e,n,a){Object(pt.a)(this,t),this.x=e,this.y=n,this.z=a}return Object(mt.a)(t,[{key:"getX",value:function(){return this.x}},{key:"setX",value:function(t){this.x=t}},{key:"getY",value:function(){return this.y}},{key:"setY",value:function(t){this.y=t}},{key:"setPosition",value:function(t,e){this.x=t,this.y=e}},{key:"toString",value:function(){return"<".concat(this.x,",").concat(this.y,">")}},{key:"distanceTo",value:function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}}],[{key:"build",value:function(){return new t(180+Pe(),Pe())}}]),t}();function Le(t,e){var n=t/window.innerWidth*360,a=e/window.innerHeight*-180+90;return new Ot(n,a)}function Fe(t,e,n){return Math.max(e,Math.min(n,t))}function ze(t,e,n){var a=n||300,o=Fe(t,0,360),r=Fe(-e,-90,90);return function(t,e,n){var a=t*Math.cos(e)*Math.sin(n),o=t*Math.sin(e)*Math.sin(n),r=t*Math.cos(n);return new Ue(a,r,o)}(a,o/180*Math.PI,(r+90)/180*Math.PI)}function _e(t,e){var n=t/360*window.innerWidth,a=(e/-180+.5)*window.innerHeight;return new Ot(n,a)}var Me=n(252),Be=n(268),He=Object(f.a)((function(){return{audioSelectorContainer:{display:"flex",flexDirection:"column"},audioSelectorTitle:{paddingRight:"16px",marginBottom:"8px",display:"flex",alignItems:"center"},audioSelectorControls:{width:"100%",display:"flex",flexDirection:"column",boxShadow:"0px -1px 1px rgba(0, 0, 0, 0.08), 1px 0px 1px rgba(0, 0, 0, 0.08), -1px 0px 1px rgba(0, 0, 0, 0.08), 0px 1px 1px rgba(0, 0, 0, 0.08);",borderRadius:"12px"},audioSelectorFileName:{height:"48px",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",paddingLeft:"16px",paddingRight:"16px"},audioSelectorIcon:{cursor:"pointer"},audioSelectorPlayControls:{height:"48px",display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:"16px",paddingRight:"16px"},audioSelectorVolumeControl:{height:"48px",display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:"16px",paddingRight:"16px",backgroundColor:"rgba(0, 0, 0, 0.05)"},audioSelectorLoopControl:{height:"48px",display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:"16px",paddingRight:"16px",backgroundColor:"rgba(0, 0, 0, 0.05)",justifyContent:"space-between",borderRadius:"0px 0px 12px 12px"}}}));function We(t){var e=t.title,n=t.name,o=t.loop,r=t.data,i=t.volume,s=t.onChange,c=t.onPlayInLoopChange,u=t.onVolumeChange,l=t.onRemove,d=He(),p=Object(a.useRef)(),h=Object(a.useState)(r||null),m=Object(w.a)(h,2),b=m[0],f=m[1],j=Object(a.useState)(n||""),y=Object(w.a)(j,2),O=y[0],k=y[1],C=Object(a.useState)(!1),S=Object(w.a)(C,2),N=S[0],A=S[1],R=Object(a.useState)(0),E=Object(w.a)(R,2),D=E[0],T=E[1],P=Object(a.useState)(0),U=Object(w.a)(P,2),L=U[0],F=U[1];Object(a.useEffect)((function(){p.current.addEventListener("canplaythrough",M),p.current.addEventListener("timeupdate",_)}),[]),Object(a.useEffect)((function(){N?p.current.play():p.current.pause()}),[N]);var z=function(t){var e=new FileReader;e.onloadend=function(){f(e.result),k(t.name),s(e.result,t.name,t.type)},e.readAsDataURL(t)},_=function(){p.current&&T(p.current.currentTime)},M=function(){p.current&&F(p.current.duration)};return Object(zt.jsxs)("div",{className:d.audioSelectorContainer,children:[Object(zt.jsx)("audio",{ref:p,src:b,loop:o}),Object(zt.jsx)("div",{className:d.audioSelectorTitle,children:Object(zt.jsx)(x.a,{variant:"body1",children:e})}),Object(zt.jsx)("input",{type:"file",id:"audio-selector-input",style:{display:"none"},onChange:function(t){var e=t.target.files[0];z(e)}}),!b&&Object(zt.jsx)(ge,{onChange:z,children:Object(zt.jsx)(v.a,{variant:"outlined",fullWidth:!0,children:"Select audio"})}),b&&Object(zt.jsxs)("div",{className:d.audioSelectorControls,children:[Object(zt.jsxs)("div",{className:d.audioSelectorFileName,children:[Object(zt.jsx)(x.a,{variant:"body2",children:O}),Object(zt.jsx)(I.a,{onClick:function(){f(null),k(""),l()},children:Object(zt.jsx)(se.a,{})})]}),Object(zt.jsxs)("div",{className:d.audioSelectorPlayControls,children:[Object(zt.jsx)("img",{src:"icons/play-small.svg",className:d.audioSelectorIcon,onClick:function(){A(!N)},alt:"play"}),Object(zt.jsx)(g.a,{m:1}),Object(zt.jsx)(Be.a,{value:D,max:L,min:0,onChange:function(t,e){T(e),p.current.currentTime=e}})]}),Object(zt.jsxs)("div",{className:d.audioSelectorVolumeControl,children:[Object(zt.jsx)("img",{src:"icons/volume-on.svg",className:d.audioSelectorIcon,alt:"volume-control"}),Object(zt.jsx)(g.a,{m:1}),Object(zt.jsx)(x.a,{variant:"body2",style:{whiteSpace:"nowrap"},children:"Playback volume"}),Object(zt.jsx)(g.a,{m:1}),Object(zt.jsx)(Be.a,{value:100*i,max:100,min:0,onChange:function(t,e){p.current.volume=e/100,u(Math.max(.01,e/100))}})]}),Object(zt.jsxs)("div",{className:d.audioSelectorLoopControl,children:[Object(zt.jsxs)("div",{style:{display:"flex"},children:[Object(zt.jsx)("img",{src:"icons/loop.svg",alt:"play-in-loop"}),Object(zt.jsx)(g.a,{m:1}),Object(zt.jsx)(x.a,{variant:"body2",children:"Play in-loop"})]}),Object(zt.jsx)("div",{children:Object(zt.jsx)(ie.a,{checked:o||!1,onChange:function(){c(!o)}})})]})]})]})}var qe=Object(f.a)((function(){return{imageSelectorContainer:{display:"flex",flexDirection:"column"},imageSelectorTitle:{paddingRight:"16px",marginBottom:"8px",display:"flex",alignItems:"center"},imageSelectorImagePreview:{width:"100%",display:"flex",flexDirection:"column",borderRadius:"12px",height:"150px",backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center",position:"relative"},optionsContainer:{width:"100%",height:"36px",position:"absolute",right:"8px",top:"8px",display:"flex",justifyContent:"flex-end",alignItems:"center",cursor:"pointer"},option:{marginLeft:"8px",width:"36px",height:"36px",display:"flex",justifyContent:"center",alignItems:"center",cursor:"pointer",boxShadow:"0px 0px 2px rgba(0, 0, 0, 0.15), 0px 4px 6px rgba(0, 0, 0, 0.15);",borderRadius:"32px",backgroundColor:"white"}}}));function Ye(t){var e=t.title,n=t.value,o=t.onChange,r=t.onRemove,i=t.removable,s=qe(),c=Object(a.useRef)(),u=function(){var t=Object(b.a)(m.a.mark((function t(e){var n,a;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ye.validateFileLoadEvent(e,"image");case 2:return t.next=4,ye.getBinaryFileData(e);case 4:n=t.sent,a=Ae.a.extension(e.type),o(n,a);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(zt.jsxs)("div",{className:s.imageSelectorContainer,children:[Object(zt.jsx)("input",{type:"file",ref:c,onChange:function(t){var e=t.target.files&&t.target.files[0];u(e)},style:{display:"none"}}),Object(zt.jsx)("div",{className:s.imageSelectorTitle,children:Object(zt.jsx)(x.a,{variant:"body1",children:e})}),!n&&Object(zt.jsx)(ge,{onChange:u,children:Object(zt.jsx)(v.a,{variant:"outlined",fullWidth:!0,children:"Select image"})}),n&&Object(zt.jsx)("div",{className:s.imageSelectorImagePreview,style:{backgroundImage:"url(".concat(n,")")},children:Object(zt.jsxs)("div",{className:s.optionsContainer,children:[Object(zt.jsx)("div",{className:s.option,children:Object(zt.jsx)("img",{src:"icons/pencil-dark.svg",alt:"remove",onClick:function(){c.current.click()}})}),i&&Object(zt.jsx)("div",{className:s.option,children:Object(zt.jsx)("img",{src:"icons/cancel.svg",alt:"remove",onClick:function(){r()}})})]})})]})}var Xe=Object(f.a)((function(){return{root:{padding:"0px"},titleContainer:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",height:"48px"},closeIcon:{position:"absolute"}}}));var $e=Object(s.b)((function(){return{}}),{setHotspotNameAction:function(t,e){return{type:Q,payload:{hotspotId:t,name:e}}},setHotspotTextAction:function(t,e){return{type:tt,payload:{hotspotId:t,text:e}}},setHotspotImageAction:function(t,e,n){return{type:et,payload:{hotspotId:t,imageData:e,extension:n}}},setHotspotAudioAction:function(t,e,n,a,o,r){return{type:nt,payload:{hotspotId:t,data:e,name:n,extension:a,loop:o,volume:r}}}})((function(t){var e=t.hotspot,n=t.onClose,a=t.setHotspotNameAction,o=t.setHotspotTextAction,r=t.setHotspotImageAction,i=t.setHotspotAudioAction,s=Xe(),c=function(){var t=Object(b.a)(m.a.mark((function t(n,a){var o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ie(n,"hotspotImage");case 2:o=t.sent,r(e.id,o,a);case 4:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();return Object(zt.jsxs)(Xt.a,{onClose:n,open:!0,maxWidth:"xs",fullWidth:!0,children:[Object(zt.jsxs)(Yt.a,{className:s.root,children:[Object(zt.jsx)(I.a,{onClick:n,className:s.closeIcon,children:Object(zt.jsx)(se.a,{})}),Object(zt.jsx)("div",{className:s.titleContainer,children:Object(zt.jsx)(x.a,{variant:"body1",children:"Edit hotspot"})})]}),Object(zt.jsxs)(re.a,{children:[Object(zt.jsx)($t.a,{size:"small",id:"hotspot-name-input",label:"Hotspot name",helperText:"Enter a short name for your hotspot",variant:"outlined",fullWidth:!0,value:e.label,onChange:function(t){a(e.id,t.target.value)}}),Object(zt.jsx)(g.a,{m:4}),Object(zt.jsx)($t.a,{fullWidth:!0,multiline:!0,rows:3,id:"hotspot-text-input",label:"Add text",helperText:"Describe your hotspot",variant:"outlined",value:e.text,onChange:function(t){o(e.id,t.target.value)}}),Object(zt.jsx)(g.a,{m:4}),Object(zt.jsx)(Ye,{title:"Add image",value:e.image.data,onChange:c,removable:!0,onRemove:function(){r(e.id,null,"")}}),Object(zt.jsx)(g.a,{m:4}),Object(zt.jsx)(We,{title:"Add audio",name:e.audio.fileName,data:e.audio.data,loop:e.audio.loop,volume:e.audio.volume,onPlayInLoopChange:function(t){i(e.id,e.audio.data,e.audio.fileName,e.audio.extension,t,e.audio.volume)},onVolumeChange:function(t){i(e.id,e.audio.data,e.audio.fileName,e.audio.extension,e.audio.loop,t)},onChange:function(t,n,a){var o=Ae.a.extension(a);i(e.id,t,n,o,e.audio.loop,e.audio.volume)},onRemove:function(){i(e.id,null,"","",!1,.5)}})]}),Object(zt.jsx)(Me.a,{children:Object(zt.jsx)(v.a,{variant:"text",color:"primary",children:"Delete hotspot"})})]})})),Ge=Object(f.a)((function(){return{hotspotContainer:{display:"flex",flexDirection:"column",alignItems:"center",position:"fixed"},hotspotIconContainer:{background:"white",border:"1px solid rgba(0, 0, 0, 0.1)",boxSizing:"border-box",borderRadius:"48px",width:"48px",height:"48px",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.15), 0px 0px 2px rgba(0, 0, 0, 0.15);",display:"flex",justifyContent:"center",alignItems:"center"},hotspotLabelContainer:{display:"flex",justifyContent:"center",alignItems:"center",padding:"8px 12px",background:"rgba(255, 255, 255, 0.9)",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.15), 0px 0px 2px rgba(0, 0, 0, 0.15);",borderRadius:"4px",marginTop:"4px"}}}));var Ve=Object(s.b)((function(){return{}}),{updateHotspotAction:function(t){return{type:Y,payload:{hotspot:t}}}})((function(t){var e=t.hotspot,n=Ge(),o=Object(a.useState)({x:100,y:400}),r=Object(w.a)(o,2),i=r[0],s=r[1],c=Object(a.useState)(!1),u=Object(w.a)(c,2),l=u[0],d=u[1],p=Object(a.useRef)(),h=Object(a.useRef)(new Ot),m=Object(a.useRef)(new Ot),b=Object(a.useRef)(!1),f={left:"".concat(i.x,"px"),top:"".concat(i.y,"px")};function j(t){var e=new Ot(t.clientX,t.clientY);return t.clientX&&t.clientY?e.setPosition(t.clientX,t.clientY):t.touches[0]?e.setPosition(t.touches[0].clientX,t.touches[0].clientY):t.changedTouches[0]&&e.setPosition(t.changedTouches[0].clientX,t.changedTouches[0].clientY),e}function g(t){var e=p.current.getBoundingClientRect(),n=j(t);b.current=!0,h.current.setPosition(n.x-e.left,n.y-e.top),m.current.setPosition(n.x,n.y)}function v(t){if(b.current){var e=j(t),n=e.x-h.current.getX(),a=e.y-h.current.getY();s({x:n,y:a})}}function y(t){b.current=!1;var n=p.current.getBoundingClientRect(),a=new Ot(n.left+n.width/2,n.top+n.height/2),o=j(t),r=new Ot(o.x,o.y);m.current.distanceTo(r)<5&&d(!0);var i=Le(a.getX(),a.getY());e.location.setPosition(i.x,i.y)}return Object(a.useEffect)((function(){window.addEventListener("mousemove",v),window.addEventListener("touchmove",v);var t=_e(e.location.x,e.location.y);return s({x:t.x,y:t.y}),function(){window.removeEventListener("mousemove",v),window.removeEventListener("touchmove",v)}}),[]),Object(zt.jsxs)("div",{children:[Object(zt.jsxs)("div",{className:n.hotspotContainer,style:f,onTouchStart:g,onTouchEnd:y,onMouseDown:g,onMouseUp:y,ref:p,children:[Object(zt.jsx)("div",{className:n.hotspotIconContainer,children:Object(zt.jsx)("img",{draggable:!1,src:"icons/".concat(Te(e,"svg")),alt:"hotspot-icon"})}),Object(zt.jsx)("div",{className:n.hotspotLabelContainer,children:Object(zt.jsx)(x.a,{variant:"body2",color:"textSecondary",children:e.label})})]}),l&&Object(zt.jsx)($e,{onClose:function(){d(!1)},hotspot:e})]})})),Je=n(249),Ke=n(266),Ze=n(259),Qe=Object(f.a)((function(){return{root:{padding:"0px"},titleContainer:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",height:"48px"},closeIcon:{position:"absolute"}}}));var tn=Object(s.b)((function(t){return{story:t.project.story}}),{updateDoorAction:function(t){return{type:J,payload:{door:t}}}})((function(t){var e=t.onClose,n=t.door,a=t.story,o=t.updateDoorAction,r=Qe();return Object(zt.jsxs)(Xt.a,{onClose:e,open:!0,maxWidth:"xs",fullWidth:!0,children:[Object(zt.jsxs)(Yt.a,{className:r.root,children:[Object(zt.jsx)(I.a,{onClick:e,className:r.closeIcon,children:Object(zt.jsx)(se.a,{})}),Object(zt.jsx)("div",{className:r.titleContainer,children:Object(zt.jsx)(x.a,{variant:"body1",children:"Edit door"})})]}),Object(zt.jsx)(re.a,{children:Object(zt.jsxs)(Je.a,{variant:"outlined",fullWidth:!0,size:"small",children:[Object(zt.jsx)(Ke.a,{id:"target-room-input-label",children:"Destination room"}),Object(zt.jsx)(Ze.a,{labelId:"target-room-input-label",id:"destination-room-select",value:n.targetRoomId,onChange:function(t){n.targetRoomId=t.target.value,o(n)},label:"Destination room",children:a.rooms.map((function(t){return Object(zt.jsx)(T.a,{value:t.id,children:t.name},t.id)}))})]})}),Object(zt.jsx)(Me.a,{children:Object(zt.jsx)(v.a,{variant:"text",color:"primary",children:"Delete door"})})]})})),en=Object(f.a)((function(){return{doorContainer:{display:"flex",flexDirection:"column",alignItems:"center",position:"fixed"},doorIconContainer:{background:"white",border:"1px solid rgba(0, 0, 0, 0.1)",boxSizing:"border-box",borderRadius:"48px",width:"48px",height:"48px",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.15), 0px 0px 2px rgba(0, 0, 0, 0.15);",display:"flex",justifyContent:"center",alignItems:"center"},doorLabelContainer:{display:"flex",justifyContent:"center",alignItems:"center",padding:"8px 12px",background:"rgba(255, 255, 255, 0.9)",boxShadow:"0px 4px 6px rgba(0, 0, 0, 0.15), 0px 0px 2px rgba(0, 0, 0, 0.15);",borderRadius:"4px",marginTop:"4px"}}}));function nn(t){var e=t.door,n=t.targetRoomName,o=en(),r=Object(a.useState)({x:200,y:400}),i=Object(w.a)(r,2),s=i[0],c=i[1],u=Object(a.useState)(!1),l=Object(w.a)(u,2),d=l[0],p=l[1],h=Object(a.useRef)(),m=Object(a.useRef)(new Ot),b=Object(a.useRef)(new Ot),f=Object(a.useRef)(!1),j={left:"".concat(s.x,"px"),top:"".concat(s.y,"px")};function g(t){var e=new Ot(t.clientX,t.clientY);return t.clientX&&t.clientY?e.setPosition(t.clientX,t.clientY):t.touches[0]?e.setPosition(t.touches[0].clientX,t.touches[0].clientY):t.changedTouches[0]&&e.setPosition(t.changedTouches[0].clientX,t.changedTouches[0].clientY),e}function v(t){var e=h.current.getBoundingClientRect(),n=g(t);f.current=!0,m.current.setPosition(n.x-e.left,n.y-e.top),b.current.setPosition(n.x,n.y)}function y(t){if(f.current){var e=g(t),n=e.x-m.current.getX(),a=e.y-m.current.getY();c({x:n,y:a})}}function O(t){f.current=!1;var n=h.current.getBoundingClientRect(),a=new Ot(n.left+n.width/2,n.top+n.height/2),o=g(t),r=new Ot(o.x,o.y);b.current.distanceTo(r)<5&&p(!0);var i=Le(a.getX(),a.getY());e.location.setPosition(i.x,i.y)}return Object(a.useEffect)((function(){window.addEventListener("mousemove",y),window.addEventListener("touchmove",y);var t=_e(e.location.x,e.location.y);return c({x:t.x,y:t.y}),function(){window.removeEventListener("mousemove",y),window.removeEventListener("touchmove",y)}}),[]),Object(zt.jsxs)("div",{children:[Object(zt.jsxs)("div",{className:o.doorContainer,style:j,onTouchStart:v,onTouchEnd:O,onMouseDown:v,onMouseUp:O,ref:h,children:[Object(zt.jsx)("div",{className:o.doorIconContainer,children:Object(zt.jsx)("img",{draggable:!1,src:"/icons/door-icon.svg",alt:"door-icon"})}),Object(zt.jsx)("div",{className:o.doorLabelContainer,children:Object(zt.jsx)(x.a,{variant:"body2",color:"textSecondary",children:n})})]}),d&&Object(zt.jsx)(tn,{onClose:function(){p(!1)},door:e})]})}var an=Object(f.a)((function(){return{backgroundImage:{width:"100%",height:"100%",position:"fixed"}}})),on=Object(s.b)((function(t){return{story:t.project.story}}),{addHotspotAction:dt})((function(t){var e=t.story,n=t.addHotspotAction,a=an(),o=function(){var t=Object(b.a)(m.a.mark((function t(a){var o,r,i,s,c,u,l,d,p;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(a.preventDefault(),o=a.dataTransfer.files&&a.dataTransfer.files[0],r=Le(a.clientX-35,a.clientY-30),!ye.isFileOfType(o,"image")){t.next=17;break}return t.next=6,ye.getBinaryFileData(o);case 6:return i=t.sent,s=Ae.a.extension(o.type),t.next=10,Ie(i,"hotspotImage");case 10:c=t.sent,(u=new wt).image.data=c,"string"===typeof s&&(u.image.extension=s),u.image.preloaded=!0,u.location=r,n(u,e.getActiveRoom().id);case 17:if(!ye.isFileOfType(o,"audio")){t.next=28;break}return t.next=20,ye.getBinaryFileData(o);case 20:l=t.sent,d=Ae.a.extension(o.type),(p=new wt).audio.data=l,"string"===typeof d&&(p.audio.extension=d),p.audio.fileName=o.name,p.location=r,n(p,e.getActiveRoom().id);case 28:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),r=e.rooms.find((function(t){return t.active}));return Object(zt.jsxs)("div",{children:[Object(zt.jsx)("img",{src:r.panoramaUrl.backgroundImage.data,alt:"room-background",className:a.backgroundImage,draggable:!1,onDragOver:function(t){t.preventDefault()},onDrop:o}),r.hotspots.map((function(t){return Object(zt.jsx)(Ve,{hotspot:t},t.id)})),r.doors.map((function(t){return Object(zt.jsx)(nn,{door:t,targetRoomName:(n=t.targetRoomId,e.rooms.find((function(t){return t.id===n})).name)},t.id);var n}))]})})),rn=n(253),sn=n(90),cn=n.n(sn),un=n(125),ln=n.n(un),dn=Object(f.a)((function(){return{root:{padding:"0px"},titleContainer:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",height:"48px"},closeIcon:{position:"absolute"}}}));var pn=Object(s.b)((function(t){return{story:t.project.story}}),{setStoryNameAction:function(t){return{type:X,payload:{name:t}}},setStoryTagsAction:function(t){return{type:$,payload:{tags:t}}},setStorySoundtrackAction:function(t){return{type:G,payload:{soundtrack:t}}}})((function(t){var e=t.onClose,n=t.story,a=t.setStoryNameAction,o=t.setStoryTagsAction,r=t.setStorySoundtrackAction,i=dn();return Object(zt.jsxs)(Xt.a,{onClose:e,open:!0,maxWidth:"xs",fullWidth:!0,children:[Object(zt.jsxs)(Yt.a,{className:i.root,children:[Object(zt.jsx)(I.a,{onClick:e,className:i.closeIcon,children:Object(zt.jsx)(se.a,{})}),Object(zt.jsx)("div",{className:i.titleContainer,children:Object(zt.jsx)(x.a,{variant:"body1",children:"Edit story"})})]}),Object(zt.jsxs)(re.a,{children:[Object(zt.jsx)($t.a,{size:"small",id:"story-name-input",label:"Story name",helperText:"Enter a short name for your story",variant:"outlined",fullWidth:!0,onChange:function(t){a(t.target.value)},value:n.name}),Object(zt.jsx)(g.a,{m:4}),Object(zt.jsx)($t.a,{size:"small",fullWidth:!0,id:"story-tags-input",label:"Story tags",helperText:"Use comma to add separate tags",variant:"outlined",onChange:function(t){var e=t.target.value.split(",");o(e)},value:n.tags.join(",")}),Object(zt.jsx)(g.a,{m:4}),Object(zt.jsx)(We,{title:"Story soundtrack",data:n.soundtrack.data,name:n.soundtrack.fileName,loop:n.soundtrack.loop,volume:n.soundtrack.volume,onPlayInLoopChange:function(t){var e=new ft;e.fileName=n.soundtrack.fileName,e.data=n.soundtrack.data,e.extension=n.soundtrack.extension,e.loop=t,e.volume=n.soundtrack.volume,r(e)},onVolumeChange:function(t){var e=new ft;e.fileName=n.soundtrack.fileName,e.data=n.soundtrack.data,e.extension=n.soundtrack.extension,e.loop=n.soundtrack.loop,e.volume=t,r(e)},onChange:function(t,e,n){var a=Ae.a.extension(n),o=new ft;o.fileName=e,o.data=t,o.extension=a,r(o)},onRemove:function(){var t=new ft;r(t)}})]}),Object(zt.jsx)(Me.a,{children:Object(zt.jsx)(v.a,{variant:"text",color:"primary",children:"Delete story"})})]})})),hn=Object(f.a)((function(t){return{root:{position:"fixed",top:0,zIndex:5,height:"96px",paddingLeft:"24px",paddingRight:"24px",width:"100%",marginLeft:"auto",marginRight:"auto",left:0,right:0,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},previewContainer:{position:"fixed",top:"0px",left:"0px",right:"0px",zIndex:5,pointerEvents:"none",display:"flex",justifyContent:"center",height:"96px",alignItems:"center"},toolBar:{backgroundColor:"rgba(0,0,0,0.6)",height:48,borderRadius:24,paddingRight:22,display:"flex",alignItems:"center"},backButton:{borderRadius:"50% 0 0 50%",color:"rgba(255, 255, 255, 0.7)"},signInButton:{fontWeight:600},divider:{height:48,backgroundColor:"rgba(255, 255, 255, 0.2)"},storyName:{marginLeft:t.spacing(2),color:"rgba(255, 255, 255, 0.7)"},toolBarIcon:{marginLeft:t.spacing(2),borderRadius:0,color:"rgba(255, 255, 255, 0.7)"},vrButton:{pointerEvents:"all",backgroundColor:t.palette.primary.main,"&:hover":{backgroundColor:t.palette.primary.dark}}}}));var mn=Object(s.b)((function(t){return{project:t.project}}),{})((function(t){var e=t.project,n=hn(),o=Object(a.useContext)(Ft),r=Object(a.useState)(!1),i=Object(w.a)(r,2),s=i[0],u=i[1],l=Object(a.useState)(!1),d=Object(w.a)(l,2),p=d[0],h=d[1],f=Object(a.useState)(!1),j=Object(w.a)(f,2),x=j[0],v=j[1],O=function(){var t=Object(b.a)(m.a.mark((function t(){return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return v(!0),t.next=3,o.saveProject(e);case 3:v(!1);case 4:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsxs)(g.a,{className:n.root,children:[Object(zt.jsxs)(g.a,{className:n.toolBar,children:[Object(zt.jsx)(I.a,{className:n.backButton,component:c.b,to:"/",children:Object(zt.jsx)(cn.a,{})}),Object(zt.jsx)(y.a,{className:n.divider,orientation:"vertical",flexItem:!0}),Object(zt.jsx)(g.a,{className:n.storyName,children:e.story.name}),Object(zt.jsx)(I.a,{className:n.toolBarIcon,onClick:function(){u(!0)},children:Object(zt.jsx)("img",{alt:"edit-story",src:"/icons/pencil.svg"})}),Object(zt.jsx)(I.a,{className:n.toolBarIcon,onClick:O,children:x?Object(zt.jsx)(rn.a,{size:24}):Object(zt.jsx)(ln.a,{})}),Object(zt.jsx)(I.a,{className:n.toolBarIcon,onClick:function(){h(!0)},children:Object(zt.jsx)("img",{alt:"share-story",src:"/icons/share-icon-light.svg"})})]}),Object(zt.jsx)(Mt,{})]}),Object(zt.jsx)("div",{className:n.previewContainer,children:Object(zt.jsx)(I.a,{className:n.vrButton,variant:"contained",color:"primary",component:c.b,to:"/view/".concat(e.id),children:Object(zt.jsx)("img",{className:n.vrButtonLogo,src:"/icons/vr.svg",alt:"preview-story"})})}),s&&Object(zt.jsx)(pn,{onClose:function(){u(!1)}}),p&&Object(zt.jsx)(ue,{onClose:function(){h(!1)},thumbnailUrl:function(t){var e=t.find((function(t){return t.isHome}));return e||(e=t[0]),e}(e.story.rooms).panoramaUrl.thumbnail.data,project:e})]})})),bn=n(273),fn=n(272),jn=n(271),gn=Object(f.a)((function(t){return{speedDial:{position:"absolute",bottom:t.spacing(4),left:t.spacing(2)}}}));var xn=Object(s.b)((function(t){return{story:t.project.story}}),{addHotspotAction:dt,addDoorAction:function(t,e){return{type:W,payload:{door:t,roomId:e}}}})((function(t){var e=t.addHotspotAction,n=t.addDoorAction,a=t.story,r=gn(),i=o.a.useState(!1),s=Object(w.a)(i,2),c=s[0],u=s[1],l=function(){u(!1)},d=[{icon:Object(zt.jsx)("img",{src:"/icons/door-icon.svg",onClick:function(){var t=a.rooms.find((function(t){return t.id!==a.getActiveRoom().id}));if(t){var e=new kt;e.targetRoomId=t.id,n(e,a.getActiveRoom().id),l()}},alt:"add-door"}),name:"Add door"},{icon:Object(zt.jsx)("img",{src:"/icons/icon-add.svg",onClick:function(){var t=new wt;e(t,a.getActiveRoom().id),l()},alt:"add-hotspot"}),name:"Add hotspot"}];return Object(zt.jsx)(bn.a,{ariaLabel:"add-hotspot-menu",className:r.speedDial,icon:Object(zt.jsx)(fn.a,{}),onClose:l,onOpen:function(){u(!0)},open:c,direction:"up",children:d.map((function(t){return Object(zt.jsx)(jn.a,{icon:t.icon,tooltipTitle:t.name},t.name)}))})})),vn=Object(f.a)((function(){return{root:{position:"fixed",bottom:0,zIndex:3,height:"96px",width:"100%",marginLeft:"6px",left:0,right:0,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}}}));function yn(){var t=vn();return Object(zt.jsx)(g.a,{className:t.root,children:Object(zt.jsx)(xn,{})})}var On=Object(f.a)((function(){return{root:{padding:"0px"},titleContainer:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",height:"48px"},closeIcon:{position:"absolute"},homeInfoContainer:{height:"48px",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}}}));var wn=Object(s.b)((function(){return{}}),{setRoomNameAction:function(t,e){return{type:K,payload:{roomId:t,name:e}}},setRoomIsHomeAction:function(t,e){return{type:rt,payload:{roomId:t,isHome:e}}},setRoomBackgroundAction:function(t,e,n){return{type:Z,payload:{roomId:t,background:e,thumbnail:n}}},setRoomBackgroundMusicAction:function(t,e,n,a,o,r){return{type:at,payload:{roomId:t,data:e,name:n,extension:a,loop:o,volume:r}}},setRoomBackgroundNarrationAction:function(t,e,n,a,o,r){return{type:ot,payload:{roomId:t,data:e,name:n,extension:a,loop:o,volume:r}}}})((function(t){var e=t.onClose,n=t.setRoomNameAction,a=t.setRoomIsHomeAction,o=t.setRoomBackgroundAction,r=t.setRoomBackgroundMusicAction,i=t.setRoomBackgroundNarrationAction,s=t.room,c=On(),u=function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Ie(e,"backgroundImage");case 2:n=t.sent,o(s.id,n.backgroundImage,n.thumbnail);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(zt.jsxs)(Xt.a,{onClose:e,open:!0,maxWidth:"xs",fullWidth:!0,children:[Object(zt.jsxs)(Yt.a,{className:c.root,children:[Object(zt.jsx)(I.a,{onClick:e,className:c.closeIcon,children:Object(zt.jsx)(se.a,{})}),Object(zt.jsx)("div",{className:c.titleContainer,children:Object(zt.jsx)(x.a,{variant:"body1",children:"Edit room"})})]}),Object(zt.jsxs)(re.a,{children:[Object(zt.jsx)($t.a,{size:"small",id:"room-name-input",label:"Room name",helperText:"Enter a short name for your room",variant:"outlined",fullWidth:!0,value:s.name,onChange:function(t){n(s.id,t.target.value)}}),Object(zt.jsx)(g.a,{m:2}),Object(zt.jsxs)("div",{className:c.homeInfoContainer,children:[Object(zt.jsxs)("div",{style:{display:"flex"},children:[Object(zt.jsx)("img",{src:"icons/home-icon.svg",alt:"mark-room-as-home"}),Object(zt.jsx)(g.a,{m:1}),Object(zt.jsx)(x.a,{variant:"body1",children:"Set as home"})]}),Object(zt.jsx)("div",{children:Object(zt.jsx)(ie.a,{checked:s.isHome,onChange:function(){a(s.id,!s.isHome)}})})]}),Object(zt.jsx)(g.a,{m:2}),Object(zt.jsx)(Ye,{title:"Background Image",value:s.panoramaUrl.thumbnail.data,onChange:u}),Object(zt.jsx)(g.a,{m:4}),Object(zt.jsx)(We,{title:"Room background music",data:s.backgroundMusic.data,name:s.backgroundMusic.fileName,loop:s.backgroundMusic.loop,volume:s.backgroundMusic.volume,onPlayInLoopChange:function(t){r(s.id,s.backgroundMusic.data,s.backgroundMusic.fileName,s.backgroundMusic.extension,t,s.backgroundMusic.volume)},onVolumeChange:function(t){r(s.id,s.backgroundMusic.data,s.backgroundMusic.fileName,s.backgroundMusic.extension,s.backgroundMusic.loop,t)},onChange:function(t,e,n){var a=Ae.a.extension(n);r(s.id,t,e,a,s.backgroundMusic.loop,s.backgroundMusic.volume)},onRemove:function(){r(s.id,null,"","",!1,.5)}}),Object(zt.jsx)(g.a,{m:4}),Object(zt.jsx)(We,{title:"Room background narration",data:s.backgroundNarration.data,name:s.backgroundNarration.fileName,loop:s.backgroundNarration.loop,volume:s.backgroundNarration.volume,onPlayInLoopChange:function(t){i(s.id,s.backgroundNarration.data,s.backgroundNarration.fileName,s.backgroundNarration.extension,t,s.backgroundNarration.volume)},onVolumeChange:function(t){i(s.id,s.backgroundNarration.data,s.backgroundNarration.fileName,s.backgroundNarration.extension,s.backgroundNarration.loop,t)},onChange:function(t,e,n){var a=Ae.a.extension(n);i(s.id,t,e,a,s.backgroundNarration.loop,s.backgroundNarration.volume)},onRemove:function(){i(s.id,null,"","",!1,.5)}})]}),Object(zt.jsx)(Me.a,{children:Object(zt.jsx)(v.a,{variant:"text",color:"primary",children:"Delete room"})})]})})),kn=Object(f.a)((function(){return{container:{minWidth:"150px",width:"175px",height:"135px",display:"flex",flexDirection:"column",borderRadius:"8px",boxSizing:"border-box",border:"2px solid",marginLeft:"8px"},roomInfoContainer:{display:"flex",alignItems:"center",padding:"12px",justifyContent:"space-between"},roomActionsContainer:{display:"flex",alignItems:"center"},roomInfo:{display:"flex",flexDirection:"column",cursor:"pointer"},roomItemsInfo:{display:"flex"},roomThumbnail:{width:"100%",height:"100%",display:"flex",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",borderRadius:"0px 0px 6px 6px",position:"relative"},editRoomContainer:{position:"absolute",width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.9)",display:"flex",justifyContent:"center",alignItems:"center"},editIcon:{cursor:"pointer",width:"17px",height:"17px"},icon:{width:"25px",height:"25px",marginRight:"5px"}}}));var Cn=Object(s.b)((function(){return{}}),{setCurrentRoomAction:lt})((function(t){var e=t.room,n=t.active,o=t.setCurrentRoomAction,r=t.hotspotCount,i=t.doorCount,s=kn(),c=Object(a.useState)(!1),u=Object(w.a)(c,2),l=u[0],d=u[1];return Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsxs)("div",{className:s.container,style:{borderColor:n?"#E34B78":"#444444"},children:[Object(zt.jsxs)("div",{className:s.roomInfoContainer,children:[Object(zt.jsxs)("div",{className:s.roomInfo,onClick:function(){o(e)},children:[Object(zt.jsx)(x.a,{variant:"body2",children:e.name}),Object(zt.jsxs)("div",{className:s.roomItemsInfo,children:[Object(zt.jsx)("img",{alt:"hotspot-count",src:"icons/hotspot-count-icon.svg"}),Object(zt.jsx)(g.a,{m:.2}),Object(zt.jsx)(x.a,{variant:"caption",children:r}),Object(zt.jsx)(g.a,{m:.5}),Object(zt.jsx)("img",{alt:"hotspot-count",src:"icons/door-count-icon.svg"}),Object(zt.jsx)(g.a,{m:.2}),Object(zt.jsx)(x.a,{variant:"caption",children:i})]})]}),Object(zt.jsxs)("div",{className:s.roomActionsContainer,children:[e.isHome&&Object(zt.jsx)("img",{src:"/icons/home-icon.svg",className:s.icon}),Object(zt.jsx)("img",{alt:"edit-room",src:"icons/pencil-dark.svg",className:s.editIcon,onClick:function(){d(!0)}})]})]}),Object(zt.jsx)("div",{className:s.roomThumbnail,style:{backgroundImage:"url(".concat(e.panoramaUrl.thumbnail.data,")")}})]}),l&&Object(zt.jsx)(wn,{onClose:function(){d(!1)},room:e})]})})),In=Object(f.a)((function(){return{container:{marginLeft:"8px",width:"48px",height:"135px",minWidth:"48px",display:"flex",flexDirection:"column",borderRadius:"8px",boxSizing:"border-box",border:"2px dashed rgba(0, 0, 0, 0.6);",justifyContent:"center",alignItems:"center"},icon:{width:"24px",height:"24px",cursor:"pointer"}}}));var Sn=Object(s.b)((function(){return{}}),{addRoomAction:function(t){return{type:q,payload:{room:t}}},setCurrentRoomAction:lt})((function(t){var e=t.addRoomAction,n=t.setCurrentRoomAction,o=In(),r=Object(a.useRef)(),i=function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=e.target.files&&e.target.files[0],s(n),e.target.value=null;case 3:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),s=function(){var t=Object(b.a)(m.a.mark((function t(a){var o,r,i;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,ye.validateFileLoadEvent(a,"image");case 2:return t.next=4,ye.getBinaryFileData(a);case 4:return o=t.sent,t.next=7,Ie(o,"backgroundImage");case 7:r=t.sent,(i=new vt).panoramaUrl.backgroundImage.data=r.backgroundImage,i.panoramaUrl.backgroundImage.extension="jpeg",i.panoramaUrl.thumbnail.data=r.thumbnail,i.panoramaUrl.thumbnail.extension="jpeg",e(i),n(i);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsx)(ge,{onChange:s,children:Object(zt.jsx)("div",{className:o.container,children:Object(zt.jsx)("img",{alt:"add-new-room",src:"icons/plus.svg",className:o.icon,onClick:function(){r.current.click()}})})}),Object(zt.jsx)("input",{id:"welcome-message-input",type:"file",className:"invisible",ref:r,onChange:i})]})})),Nn=Object(f.a)((function(){return{container:{width:"100%",height:"100%",position:"fixed",display:"flex",alignItems:"center",flexDirection:"column-reverse",pointerEvents:"none",zIndex:5},header:{borderRadius:"12px 12px 0px 0px",backgroundColor:"white",width:"600px",height:"48px",display:"flex",alignItems:"center",pointerEvents:"all"},body:{backgroundColor:"white",width:"600px",height:"200px",display:"flex",flexDirection:"column",pointerEvents:"all"},paginationControls:{width:"100%",height:"48px",display:"flex",flexDirection:"row-reverse",paddingRight:"12px"},roomCards:{display:"flex",height:"100%",alignItems:"center",overflow:"hidden",flex:1}}}));var An=Object(s.b)((function(t){return{story:t.project.story,rooms:t.project.story.rooms}}),{})((function(t){var e=t.rooms,n=t.story,o=Nn(),r=Object(a.useRef)(0),i=Object(a.useRef)(),s=Object(a.useState)(!1),c=Object(w.a)(s,2),u=c[0],l=c[1];return Object(zt.jsxs)("div",{className:o.container,children:[u&&Object(zt.jsxs)("div",{className:o.body,children:[Object(zt.jsx)(y.a,{style:{width:"100%"}}),Object(zt.jsxs)("div",{className:o.paginationControls,children:[Object(zt.jsx)(I.a,{onClick:function(){r.current+=250,r.current=Math.min(i.current.scrollWidth-i.current.clientWidth,r.current),i.current.scroll({left:r.current,behavior:"smooth"})},children:Object(zt.jsx)("img",{alt:"move-right",src:"icons/chevron-right.svg"})}),Object(zt.jsx)(I.a,{onClick:function(){r.current-=250,r.current=Math.max(0,r.current),i.current.scroll({left:r.current,behavior:"smooth"})},children:Object(zt.jsx)("img",{alt:"move-right",src:"icons/chevron-left.svg"})})]}),Object(zt.jsxs)("div",{className:o.roomCards,ref:i,children:[e.map((function(t){return Object(zt.jsx)(Cn,{room:t,active:n.getActiveRoom().id===t.id,hotspotCount:t.hotspots.length,doorCount:t.doors.length},t.id)})),Object(zt.jsx)(Sn,{})]})]}),Object(zt.jsxs)("div",{className:o.header,children:[Object(zt.jsx)(I.a,{onClick:function(){l(!u)},children:Object(zt.jsx)("img",{alt:"toggle-rooms-panel",src:"icons/chevron-".concat(u?"bottom":"top",".svg")})}),Object(zt.jsxs)(x.a,{variant:"body2",children:["Rooms (",e.length,")"]})]})]})}));function Rn(){return Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsx)(mn,{}),Object(zt.jsx)(on,{}),Object(zt.jsx)(yn,{}),Object(zt.jsx)(An,{})]})}var En=n(30),Dn=n.n(En),Tn=(n(193),n(74)),Pn=function t(e,n,a){Object(pt.a)(this,t),this.x=e,this.y=n,this.text=a};function Un(t){var e=1200,n=document.createElement("canvas"),a=n.getContext("2d");n.width=e,n.height=1600,a.font="".concat(52,"pt Nunito"),a.fillStyle="rgba(0, 0, 0, 0.7)",a.fillRect(0,0,n.width,n.height),a.fillStyle="white";var o=function(t,e,n,a,o,r){var i=[],s=e.split(/(\s+)/),c="";return s.forEach((function(e){var s="".concat(c+e," ");t.measureText(s).width>o?(i.push(new Pn(n,a,c.trim())),c="".concat(e," "),a+=r):c=s})),i.push(new Pn(n,a,c.trim())),i}(a,t,10,62,e,60),r=o[o.length-1].y+52;return o.forEach((function(t){return a.fillText(t.text,t.x,t.y)})),{width:e,height:r,drawCanvas:n}}function Ln(t){return new Promise((function(e){var n=new Image;n.crossOrigin="anonymous",n.onload=function(){e(n)},n.src=t}))}var Fn=function(t){var e=t.hotspot,n=Object(a.useState)(""),o=Object(w.a)(n,2),r=o[0],i=o[1],s=Object(a.useState)(0),c=Object(w.a)(s,2),u=c[0],l=c[1],d=Object(a.useState)(0),p=Object(w.a)(d,2),h=p[0],f=p[1];Object(a.useEffect)((function(){g()}),[]);var j=function(){return!e.image.data&&!e.text},g=function(){var t=Object(b.a)(m.a.mark((function t(){var n,a,o,r,s,c,u,d,p,h,b,j,g,x,v,y;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n={},a=Boolean(e.image.data),o=Boolean(e.text),r=0,s=0,c=null,u=0,o&&(c=Un(e.text),r=c.width>r?c.width:r,s+=c.height),d=document.createElement("canvas"),p=d.getContext("2d"),d.width=r,d.height=s,!a){t.next=25;break}return t.next=15,Ln(e.image.data);case 15:h=t.sent,b=h.width,j=h.height,u=j*((g=b>=j&&r>0?r:b)/b),r=h.width>r?h.width:r,s+=u,d.width=r,d.height=s,p.drawImage(h,r/2-g/2,0,g,u);case 25:null!==c&&(x=document.createElement("canvas"),v=x.getContext("2d"),x.width=c.width,x.height=c.height,v.drawImage(c.drawCanvas,0,0,r,s,0,0,r,s),p.drawImage(x,0,u,r,c.height)),(o||a)&&(y=we(d.width,d.height,3),n.image={src:d.toDataURL("png"),width:y.getX(),height:y.getY()}),n.image&&(i(n.image.src),l(n.image.width),f(n.image.height));case 28:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return Object(zt.jsxs)(Tn.Entity,{hotspot:"coordinates: ".concat(e.location.getX()," ").concat(e.location.getY(),";\n            isAudioOnly: ").concat(j()),class:"hotspot",geometry:"primitive: plane",material:" transparent: true; alphaTest:.5; opacity:0",scale:"100 100","look-at":"[camera]",children:[Object(zt.jsx)(Tn.Entity,{class:"outer-trigger raycast-trigger",material:" opacity: 0; alphaTest: .5; transparent: true",geometry:" primitive: plane; height: 1; width: 1;",position:"0 0 -1"}),Object(zt.jsx)(Tn.Entity,{class:"center-trigger raycast-trigger",material:" opacity: 0; alphaTest: .5; transparent: true",geometry:" primitive: plane; height: .2; width: .2;",position:"0 0 -1"}),Object(zt.jsx)(Tn.Entity,{class:"content-zone-trigger raycast-trigger",material:" opacity: 0; alphaTest: .5; transparent: true",geometry:" primitive: plane; height: .5; width: .5"}),Object(zt.jsx)(Tn.Entity,{"pulsating-marker":!0,animation__pulsation:" property: scale; from: 1 1 1; to: 1.3 1.3 1.3; loop: true; dur: 700; dir: alternate;",children:Object(zt.jsx)("a-image",{src:"/icons/icon-hotspot-default.png","alpha-test":".5","animation__scale-in":" property: scale; dur: 500; to: 1 1 1; startEvents: start-scale-in; pauseEvents: stop-scale-in;","animation__scale-out":" property: scale; dur: 500; to: .001 .001 .001; startEvents: start-scale-out; pauseEvents: stop-scale-out;"})}),j()&&Object(zt.jsx)("a-image",{src:"/icons/icon-audio.png",position:"0 0 .1","hidden-marker":!0,opacity:"0","alpha-test":".5",scale:".5 .5 .5","animation__fade-in":" property: opacity; from: 0; to: 1; dur: 500; pauseEvents: stop-fade-in; startEvents: start-fade-in;","animation__fade-out":" property: opacity; from: 1; to: 0; dur: 500; pauseEvents: stop-fade-out; startEvents: start-fade-out; "}),!j()&&Object(zt.jsx)("a-image",{src:"/icons/icon-hotspot-hover.png","hidden-marker":!0,position:"0 0 .1",opacity:"0","alpha-test":".5","animation__fade-in":" property: opacity; from: 0; to: 1; dur: 500; pauseEvents: stop-fade-in; startEvents: start-fade-in;","animation__fade-out":" property: opacity; from: 1; to: 0; dur: 500; pauseEvents: stop-fade-out; startEvents: start-fade-out;"}),Object(zt.jsx)("a-text",{value:e.label,class:"hotspot-name",align:"center",visible:"false",position:"0 -.5 0","alpha-test":".5"}),Object(zt.jsxs)("a-entity",{"hotspot-content":!0,class:"hotspot-content",scale:"0 0 0",width:"2",height:"2",position:"0 0 -.3",children:[(e.text||e.image.data)&&Object(zt.jsx)("a-image",{src:r,width:u,height:h}),e.audio.data&&Object(zt.jsx)("a-sound",{src:e.audio.data,volume:e.audio.volume,loop:e.audio.loop,sound:"positional: false"})]})]})};function zn(t){var e=t.door,n=t.targetRoomName;return Object(zt.jsxs)("a-entity",{door:function(){var t=e.location,n=e.targetRoomId;return"coordinates: ".concat(t.x," ").concat(t.y,";\n                roomId: ").concat(n,";\n                autoTime: ",!1)}(),class:"door",geometry:"primitive: plane",material:" transparent: true; opacity: 0",scale:"100 100",opacity:"1","look-at":"[camera]",children:[Object(zt.jsx)("a-entity",{class:"outer-door-trigger raycast-trigger",material:" opacity: 0 0; transparent: true",geometry:" primitive: plane; height: 1; width: 1;",position:"0 0 -1"}),Object(zt.jsx)("a-entity",{class:"center-door-trigger raycast-trigger",material:" opacity: 0 0; transparent: true",geometry:" primitive: plane; height: .5; width: .5;",position:"0 0 -1"}),Object(zt.jsx)("a-text",{value:n,class:"hotspot-name",align:"center",position:"0 -.5 0",visible:"false","alpha-test":".5"}),Object(zt.jsx)("a-entity",{"door-pulsating-marker":!0,"animation__scale-out":" property: scale; to: .001 .001 .001; dur: 200; startEvents: start-scale-out; pauseEvents: stop-scale-out;","animation__scale-in":" property: scale; dur: 200; to: 1 1 1; startEvents: start-scale-in; pauseEvents: stop-scale-in",children:Object(zt.jsx)("a-image",{src:"/icons/icon-hotspot-default.png","alpha-test":".5",animation__pulsation:" property: scale; from: 1 1 1; to: .001 .001 .001; loop: true; dur: 1500; dir: normal;"})}),Object(zt.jsx)("a-image",{src:"/icons/icon-doorhotspot.png",opacity:"0","animation__fade-in":" property: opacity; from: 0; to: 1; dur: 500; pauseEvents: stop-fade-in; startEvents: start-fade-in; ","animation__fade-out":" property: opacity; from: 1; to: 0; dur: 500; pauseEvents: stop-fade-out; startEvents: start-fade-out; ",position:"0 0 .1","hidden-marker":!0,width:".5",height:".5"})]})}function _n(t){if(t.panoramaUrl.backgroundImage.preloaded)return t.panoramaUrl.backgroundImage.data;var e=t.panoramaUrl.backgroundImage.data;return new Promise((function(n){var a=new Image;a.crossOrigin="anonymous",a.onload=function(){var e=document.createElement("canvas");e.width=a.width,e.height=a.height,e.getContext("2d").drawImage(a,0,0);var o=e.toDataURL("image/png");t.panoramaUrl.backgroundImage.data=o,t.panoramaUrl.backgroundImage.preloaded=!0,n()},a.src=e}))}var Mn=Object(f.a)((function(){return{enterVRContainer:{position:"fixed",right:"24px",bottom:"24px",width:"48px",height:"48px",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0,0,0,0.6)",borderRadius:24}}}));var Bn=Object(s.b)((function(t){return{story:t.project.story}}),{setCurrentRoomAction:lt})((function(t){var e=t.story,n=t.setCurrentRoomAction,o=Mn(),r=Object(a.useRef)(),i=Object(a.useRef)();Object(a.useEffect)((function(){r.current.addEventListener("switch-room",(function(t){s(t.detail)}))}),[]);var s=function(){var t=Object(b.a)(m.a.mark((function t(a){var o;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=e.rooms.find((function(t){return t.id===a})),t.next=3,_n(o);case 3:n(o),i.current.addEventListener("materialtextureloaded",(function(){r.current.emit("reset-camera")}));case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),c=e.rooms.find((function(t){return t.active}));return Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsxs)("a-scene",{ref:r,"preview-space":!0,"device-orientation-permission-ui":"enabled: true","loading-screen":"enabled: false","vr-mode-ui":"enterVRButton: #enterVRButton;",children:[Object(zt.jsxs)("a-camera",{"wasd-controls-enabled":"false","look-controls-enabled":"true",fov:"65","animation__zoom-in":" property: zoom; from: 1; startEvents: start-zoom-in; to: 5;",zoom:"1",near:"1",children:[e.soundtrack.data&&Object(zt.jsx)("a-sound",{src:e.soundtrack.data,autoplay:!0,volume:e.soundtrack.volume,loop:e.soundtrack.loop,class:"soundtrack-audio"}),Object(zt.jsx)("a-cursor",{id:"cursor","animation__scale-out":"property: scale; from: 1 1 1; to: .2 .2 .2; startEvents: start-scale-out;"})]}),c.hotspots.map((function(t){return Object(zt.jsx)(Fn,{hotspot:t},t.id)})),c.doors.map((function(t){return Object(zt.jsx)(zn,{door:t,targetRoomName:(n=t.targetRoomId,e.rooms.find((function(t){return t.id===n})).name)},t.id);var n})),c&&Object(zt.jsxs)("a-entity",{children:[c.backgroundNarration.data&&Object(zt.jsx)("a-sound",{src:c.backgroundNarration.data,autoplay:!0,volume:c.backgroundNarration.volume,loop:c.backgroundNarration.loop,class:"narration-audio",sound:"positional: false"}),c.backgroundMusic.data&&Object(zt.jsx)("a-sound",{src:c.backgroundMusic.data,autoplay:!0,volume:c.backgroundMusic.volume,loop:c.backgroundMusic.loop,sound:"positional: false"})]}),Object(zt.jsx)("a-sky",{ref:i,src:c.panoramaUrl.backgroundImage.data,radius:"512"})]}),Object(zt.jsx)("div",{className:o.enterVRContainer,children:Object(zt.jsx)(I.a,{id:"enterVRButton",children:Object(zt.jsx)(x.a,{className:"light-text-90",children:"VR"})})})]})})),Hn=Object(f.a)((function(){return{backButtonContainer:{position:"fixed",left:"24px",top:"24px",width:"48px",height:"48px",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(0,0,0,0.6)",borderRadius:24},icon:{color:"rgba(255, 255, 255, 0.7)"}}}));var Wn=Object(s.b)((function(t){return{project:t.project}}),{setProjectAction:ct,setStoryAction:ut,setCurrentRoomAction:lt})((function(t){var e=t.project,n=t.setProjectAction,o=t.setStoryAction,r=t.setCurrentRoomAction,i=Hn(),s=Object(a.useContext)(Ft),c=Object(a.useState)(Boolean(e)),l=Object(w.a)(c,2),d=l[0],p=l[1],h=Object(u.f)(),f=Object(u.g)().projectId;Object(a.useEffect)(Object(b.a)(m.a.mark((function t(){var a,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(d){t.next=14;break}return t.next=3,s.loadProjectWithId(f);case 3:return a=t.sent,t.next=6,s.loadProject(a);case 6:return r=t.sent,n(r),o(r.story),t.next=11,j(r.story.rooms);case 11:p(!0),t.next=15;break;case 14:j(e.story.rooms);case 15:case"end":return t.stop()}}),t)}))),[]);var j=function(){var t=Object(b.a)(m.a.mark((function t(e){var n;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(n=e.find((function(t){return t.isHome})))||(n=e[0]),t.next=4,_n(n);case 4:r(n);case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return d&&Object(zt.jsxs)(zt.Fragment,{children:[Object(zt.jsx)(Bn,{}),Object(zt.jsx)("div",{className:i.backButtonContainer,children:Object(zt.jsx)(I.a,{onClick:function(){document.documentElement.classList.remove("a-fullscreen"),h.goBack()},children:Object(zt.jsx)(cn.a,{className:i.icon})})})]})}));function qn(){var t=o.a.useMemo((function(){return Object(d.a)({palette:{type:"light",primary:{dark:"#de2e62",main:"#E34B78",light:"#e86f93"},secondary:{dark:"#333333",main:"#474747",light:"#C1C1C1"}},typography:{fontFamily:["Inter","sans-serif"],button:{textTransform:"none"},h1:{fontSize:"20px",fontStyle:"normal",fontWeight:"bold",lineHeight:"24px"},h2:{fontSize:"16px",fontStyle:"normal",fontWeight:"bold",lineHeight:"20px"},body1:{fontSize:"20px",fontStyle:"normal",fontWeight:"normal",lineHeight:"24px"},body2:{fontSize:"14px",fontStyle:"normal",fontWeight:"normal",lineHeight:"20px"}}})}),[]);return Object(zt.jsx)("div",{className:"App",children:Object(zt.jsxs)(p.a,{theme:t,children:[Object(zt.jsx)(l.a,{}),Object(zt.jsx)(c.a,{children:Object(zt.jsxs)(u.c,{children:[Object(zt.jsx)(u.a,{path:"/editor",component:Rn}),Object(zt.jsx)(u.a,{path:"/view/:projectId",component:Wn}),Object(zt.jsx)(u.a,{path:"/",component:De})]})})]})})}var Yn=n(70),Xn=n(20),$n=n.n(Xn),Gn=null;var Vn={isShowingSignInDialog:!1};var Jn=[];var Kn=[];var Zn=n(65);var Qn=Object(Yn.b)({user:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Gn,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case P:return $n()(t,{$set:e.payload.value});case L:return $n()(t,{displayName:{$set:e.payload.value}});case U:return $n()(t,{$set:Gn});default:return t}},display:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Vn,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case _:return $n()(t,{isShowingSignInDialog:{$set:e.payload.value}});default:return t}},userStories:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Jn,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case F:return $n()(t,{$set:e.payload.value});default:return t}},publicStories:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Kn,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case z:return $n()(t,{$set:e.payload.value});default:return t}},project:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1?arguments[1]:void 0;switch(e.type){case V:return $n()(t,{$set:e.payload.project});case M:return $n()(t,{story:{$set:e.payload.value}});case B:return $n()(t,{story:{rooms:{$set:t.story.rooms.map((function(t){return t.id!==e.payload.room.id?Object(O.a)(Object(O.a)({},t),{},{active:!1}):Object(O.a)(Object(O.a)({},t),{},{active:!0})}))}}});case H:return $n()(t,{story:{rooms:{$set:t.story.rooms.map((function(t){return t.id===e.payload.roomId&&t.hotspots.push(e.payload.hotspot),t}))}}});case W:return $n()(t,{story:{rooms:{$set:t.story.rooms.map((function(t){return t.id===e.payload.roomId&&t.doors.push(e.payload.door),t}))}}});case q:return $n()(t,{story:{rooms:{$push:[e.payload.room]}}});case Y:return $n()(t,{story:{rooms:{hotspots:t.story.rooms.hotspots((function(t){return t.id===e.payload.hotspot.id?Object(O.a)(Object(O.a)({},t),e.payload.hotspot):t}))}}});case X:return $n()(t,{story:{name:{$set:e.payload.name}}});case $:return $n()(t,{story:{tags:{$set:e.payload.tags}}});case G:return $n()(t,{story:{soundtrack:{$set:e.payload.soundtrack}}});case J:var n=t.story.getActiveRoom(),a=t.story.rooms.find((function(t){return t.id===n.id}));return $n()(t,{story:{rooms:{doors:{$set:a.doors.map((function(t){return t.id===e.payload.door.id?Object(O.a)(Object(O.a)({},t),e.payload.door):t}))}}}});case K:return $n()(t,{story:{rooms:{$set:t.story.rooms.map((function(t){return t.id!==e.payload.roomId?t:Object(O.a)(Object(O.a)({},t),{},{name:e.payload.name})}))}}});case rt:return $n()(t,{story:{rooms:{$set:t.story.rooms.map((function(t){return t.id!==e.payload.roomId?Object(O.a)(Object(O.a)({},t),{},{isHome:!1}):Object(O.a)(Object(O.a)({},t),{},{isHome:e.payload.isHome})}))}}});case Z:var o=t.story.getActiveRoom();return $n()(t,{story:{rooms:{$set:t.story.rooms.map((function(t){return t.id!==o.id?t:Object(O.a)(Object(O.a)({},t),{},{panoramaUrl:Object(O.a)(Object(O.a)({},t.panoramaUrl),{},{backgroundImage:Object(O.a)(Object(O.a)({},t.panoramaUrl.backgroundImage),{},{data:e.payload.background}),thumbnail:Object(O.a)(Object(O.a)({},t.panoramaUrl.thumbnail),{},{data:e.payload.thumbnail})})})}))}}});case at:return $n()(t,{story:{rooms:{$set:t.story.rooms.map((function(t){return t.id!==e.payload.roomId?t:Object(O.a)(Object(O.a)({},t),{},{backgroundMusic:Object(O.a)(Object(O.a)({},t.backgroundMusic),{},{data:e.payload.data,fileName:e.payload.name,extension:e.payload.extension,loop:e.payload.loop,volume:e.payload.volume})})}))}}});case ot:return $n()(t,{story:{rooms:{$set:t.story.rooms.map((function(t){return t.id!==e.payload.roomId?t:Object(O.a)(Object(O.a)({},t),{},{backgroundNarration:Object(O.a)(Object(O.a)({},t.backgroundNarration),{},{data:e.payload.data,fileName:e.payload.name,extension:e.payload.extension,loop:e.payload.loop,volume:e.payload.volume})})}))}}});case Q:var r=t.story.getActiveRoom(),i=t.story.rooms.indexOf(r);return $n()(t,{story:{rooms:Object(Zn.a)({},i,{hotspots:{$set:r.hotspots.map((function(t){return t.id!==e.payload.hotspotId?t:Object(O.a)(Object(O.a)({},t),{},{label:e.payload.name})}))}})}});case tt:var s=t.story.getActiveRoom(),c=t.story.rooms.indexOf(s);return $n()(t,{story:{rooms:Object(Zn.a)({},c,{hotspots:{$set:s.hotspots.map((function(t){return t.id!==e.payload.hotspotId?t:Object(O.a)(Object(O.a)({},t),{},{text:e.payload.text})}))}})}});case et:var u=t.story.getActiveRoom(),l=t.story.rooms.indexOf(u);return $n()(t,{story:{rooms:Object(Zn.a)({},l,{hotspots:{$set:u.hotspots.map((function(t){return t.id!==e.payload.hotspotId?t:Object(O.a)(Object(O.a)({},t),{},{image:Object(O.a)(Object(O.a)({},t.image),{},{extension:e.payload.extension,data:e.payload.imageData})})}))}})}});case nt:var d=t.story.getActiveRoom(),p=t.story.rooms.indexOf(d);return $n()(t,{story:{rooms:Object(Zn.a)({},p,{hotspots:{$set:d.hotspots.map((function(t){return t.id!==e.payload.hotspotId?t:Object(O.a)(Object(O.a)({},t),{},{audio:Object(O.a)(Object(O.a)({},t.audio),{},{fileName:e.payload.name,extension:e.payload.extension,data:e.payload.data,loop:e.payload.loop,volume:e.payload.volume})})}))}})}});default:return t}}}),ta=Object(Yn.c)(Qn);Dn.a.registerComponent("hotspot",{schema:{coordinates:{type:"string",parse:function(t){var e=t.split(" "),n=Object(w.a)(e,2),a=n[0],o=n[1];return ze(parseInt(a,10),parseInt(o,10))}},isAudioOnly:{type:"boolean"}},hideHotspot:function(){this.el.setAttribute("visible",!1)},showHotspot:function(){this.el.setAttribute("visible",!0)},showOtherHotspots:function(){this.el.sceneEl.querySelectorAll(".hotspot, .door").forEach((function(t){return t.emit("show")}))},hideOtherHotspots:function(){var t=this;this.el.sceneEl.querySelectorAll(".hotspot, .door").forEach((function(e){return e!==t.el&&e.emit("hide")}))},showHotspotName:function(){this.hotspotName.setAttribute("visible",!0),console.log("show")},hideHotspotName:function(){this.hotspotName.setAttribute("visible",!1),console.log("hide")},init:function(){var t=this,e=this.data.coordinates,n=e.x,a=e.y,o=e.z;this.contentIsActive=!1,this.el.object3D.position.set(n,a,o),this.centerTrigger=this.el.querySelector(".center-trigger"),this.outerTrigger=this.el.querySelector(".outer-trigger"),this.contentZoneTrigger=this.el.querySelector(".content-zone-trigger"),this.hotspotContent=this.el.querySelector("[hotspot-content]"),this.hiddenMarker=this.el.querySelector("[hidden-marker]"),this.pulsatingMarker=this.el.querySelector("[pulsating-marker]"),this.hotspotName=this.el.querySelector(".hotspot-name"),this.hideHotspot=this.hideHotspot.bind(this),this.showHotspot=this.showHotspot.bind(this),this.el.addEventListener("hide",this.hideHotspot),this.el.addEventListener("show",this.showHotspot),this.outerTrigger.addEventListener("raycaster-intersected",(function(){t.pulsatingMarker.emit("scale-out"),t.hiddenMarker.emit("fade-in"),t.showHotspotName()})),this.outerTrigger.addEventListener("raycaster-intersected-cleared",(function(){t.pulsatingMarker.emit("scale-in"),t.hiddenMarker.emit("fade-out"),t.hideHotspotName()})),this.centerTrigger.addEventListener("raycaster-intersected",(function(){t.contentIsActive||(t.contentIsActive=!0,t.data.isAudioOnly||t.hiddenMarker.emit("fade-out"),t.pulsatingMarker.emit("scale-out"),t.hotspotContent.emit("show-content"),t.hideOtherHotspots(),t.hideHotspotName())})),this.contentZoneTrigger.addEventListener("raycaster-intersected-cleared",(function(){t.data.isAudioOnly||t.hiddenMarker.emit("fade-in"),t.hotspotContent.emit("hide-content"),t.showOtherHotspots(),t.showHotspotName(),t.contentIsActive=!1})),this.el.emit("hide"),setTimeout((function(){t.el.emit("show")}),200)}}),Dn.a.registerComponent("pulsating-marker",{init:function(){this.scaleIn=this.scaleIn.bind(this),this.scaleOut=this.scaleOut.bind(this),this.pulsatingHotspot=this.el.querySelector("a-image"),this.el.addEventListener("scale-in",this.scaleIn),this.el.addEventListener("scale-out",this.scaleOut)},scaleIn:function(){var t=this.pulsatingHotspot,e=t.getAttribute("scale").clone();t.emit("stop-scale-out"),t.setAttribute("animation__scale-in","from",e),t.emit("start-scale-in")},scaleOut:function(){var t=this.pulsatingHotspot,e=t.getAttribute("scale").clone();t.emit("stop-scale-in"),t.setAttribute("animation__scale-out","from",e),t.emit("start-scale-out")}}),Dn.a.registerComponent("hidden-marker",{init:function(){var t=this.el;this.fadeIn=this.fadeIn.bind(this),this.fadeOut=this.fadeOut.bind(this),t.addEventListener("fade-in",this.fadeIn),t.addEventListener("fade-out",this.fadeOut)},fadeOut:function(){this.el.emit("stop-fade-in"),this.el.emit("start-fade-out")},fadeIn:function(){this.el.emit("stop-fade-out"),this.el.emit("start-fade-in")}}),Dn.a.registerComponent("hotspot-content",{animationScaleOut:{property:"scale",from:"1 1 1",to:".001 .001 .001",startEvents:"start-scale-out",pauseEvents:"stop-scale-out",easing:"easeInQuart"},animationScaleIn:{property:"scale",from:".001 .001 .001",to:"1 1 1",startEvents:"start-scale-in",pauseEvents:"stop-scale-in",easing:"easeInQuart"},init:function(){var t=this,e=this.el;this.soundElement=this.el.querySelector("a-sound"),this.imageElement=this.el.querySelector("a-image"),e.addEventListener("show-content",this.showContent.bind(this)),e.addEventListener("hide-content",this.hideContent.bind(this)),e.setAttribute("animation__scale-in",this.animationScaleIn),e.setAttribute("animation__scale-out",this.animationScaleOut),e.addEventListener("animationcomplete",(function(e){"animation__scale-out"===e.detail.name&&t.imageElement.setAttribute("visible",!1)})),e.addEventListener("animationbegin",(function(e){"animation__scale-in"===e.detail.name&&t.imageElement.setAttribute("visible",!0)}))},showContent:function(){var t=this.el,e=this.soundElement;if(e&&(t.sceneEl.emit("pause-narration-audio"),e.components.sound.playSound()),this.imageElement){var n=t.getAttribute("scale").clone();t.setAttribute("animation__scale-in","from",n),t.emit("start-scale-in")}},hideContent:function(){var t=this.el,e=this.soundElement;if(e&&(t.sceneEl.emit("play-narration-audio"),e.components.sound.stopSound()),this.imageElement){var n=t.getAttribute("scale").clone();t.setAttribute("animation__scale-out","from",n),t.emit("start-scale-out")}}}),Dn.a.registerComponent("door-pulsating-marker",{init:function(){var t=this.el;this.scaleIn=this.scaleIn.bind(this),this.scaleOut=this.scaleOut.bind(this),this.pulsatingHotspot=this.el.querySelector("a-image"),t.addEventListener("scale-in",this.scaleIn),t.addEventListener("scale-out",this.scaleOut)},scaleIn:function(){var t=this.pulsatingHotspot,e=t.getAttribute("scale").clone();t.emit("stop-scale-out"),t.setAttribute("animation__scale-in","from",e),t.emit("start-scale-in")},scaleOut:function(){var t=this.pulsatingHotspot,e=t.getAttribute("scale").clone();t.emit("stop-scale-in"),t.setAttribute("animation__scale-out","from",e),t.emit("start-scale-out")}});Dn.a.registerComponent("door",{schema:{coordinates:{type:"string",parse:function(t){var e=t.split(" "),n=Object(w.a)(e,2),a=n[0],o=n[1];return ze(parseInt(a,10),parseInt(o,10))}},autoTime:{type:"number",parse:function(t){return 0===t?700:1e3*t}},roomId:{type:"string"}},hideDoorway:function(){this.el.setAttribute("visible",!1)},showDoorway:function(){this.el.setAttribute("visible",!0)},init:function(){var t=this,e=this.data.coordinates,n=e.x,a=e.y,o=e.z;this.el.object3D.position.set(n,a,o),this.inTransitionProcess=!1;var r=this.el.querySelector(".center-door-trigger"),i=this.el.querySelector(".outer-door-trigger"),s=this.el.querySelector(".hotspot-name"),c=this.el.querySelector("[hidden-marker]"),u=this.el.querySelector("[door-pulsating-marker]");c.setAttribute("animation__fade-out","dur",5e3),this.hideDoorway=this.hideDoorway.bind(this),this.showDoorway=this.showDoorway.bind(this),this.el.addEventListener("hide",this.hideDoorway),this.el.addEventListener("show",this.showDoorway),i.addEventListener("raycaster-intersected",(function(){u.emit("scale-out"),c.emit("fade-in"),s.setAttribute("visible",!0)})),i.addEventListener("raycaster-intersected-cleared",(function(){u.emit("scale-in"),c.emit("fade-out"),s.setAttribute("visible",!1)})),c.addEventListener("animationcomplete",(function(e){"animation__fade-out"===e.detail.name&&t.inTransitionProcess&&t.el.sceneEl.emit("switch-room-smoothly",{roomId:t.data.roomId})})),r.addEventListener("raycaster-intersected",(function(){t.inTransitionProcess=!0,c.setAttribute("animation__fade-out","dur",700),c.emit("fade-out")})),r.addEventListener("raycaster-intersected-cleared",(function(){t.inTransitionProcess=!1,c.setAttribute("animation__fade-out","dur",700)}))}}),Dn.a.registerComponent("preview-space",{init:function(){var t=this,e=this.el;this.camera=e.querySelector("a-camera"),this.cursor=this.camera.querySelector("a-cursor"),this.countdown=e.querySelector("[preview-countdown]"),this.enterVR=e.querySelector(".a-enter-vr"),e.addEventListener("run-countdown",(function(){return t.countdown.emit("run")})),e.addEventListener("show-countdown",(function(){t.countdown.setAttribute("visible",!0)})),e.addEventListener("hide-countdown",(function(){t.countdown.setAttribute("visible",!1)})),this.camera.addEventListener("animationcomplete",(function(e){"animation__zoom-in"===e.detail.name&&t.switchRoom(t.roomId)})),["narration","background","soundtrack"].forEach((function(t){e.addEventListener("touch-".concat(t,"-audio"),(function(){var n=e.querySelector(".".concat(t,"-audio"));if(n){var a=n.getAttribute("volume");n.setAttribute("volume",0),n.components.sound.playSound(),setTimeout((function(){n.components.sound.pauseSound(),n.setAttribute("volume",a)}),0)}})),e.addEventListener("pause-".concat(t,"-audio"),(function(){var n=e.querySelector(".".concat(t,"-audio"));n&&(n.setAttribute("paused",!0),n.components.sound.pauseSound())})),e.addEventListener("play-".concat(t,"-audio"),(function(){var n=e.querySelector(".".concat(t,"-audio"));n&&"true"!==n.getAttribute("played-once")&&(n.setAttribute("paused",!1),n.components.sound.playSound())}))})),e.addEventListener("touch-all-audio",(function(){e.emit("touch-narration-audio"),e.emit("touch-soundtrack-audio"),e.emit("touch-background-audio")})),e.addEventListener("play-all-audio",(function(){e.emit("play-narration-audio"),e.emit("play-soundtrack-audio"),e.emit("play-background-audio")})),e.addEventListener("pause-all-audio",(function(){e.emit("pause-narration-audio"),e.emit("pause-soundtrack-audio"),e.emit("pause-background-audio")})),e.addEventListener("switch-room-last",(function(){t.switchRoom("last")})),e.addEventListener("switch-room-home",(function(){t.switchRoom("home")})),e.addEventListener("switch-room-smoothly",(function(e){t.roomId=e.detail.roomId,t.zoomCamera()})),e.addEventListener("reset-camera",(function(){t.resetCamera()}))},resetCamera:function(){this.camera.setAttribute("zoom",1),this.cursor.setAttribute("scale",new Ue(1,1,1))},zoomCamera:function(){this.camera.emit("start-zoom-in"),this.cursor.emit("start-scale-out")},switchRoom:function(t){var e=this.el.querySelector(".narration-audio");e&&e.setAttribute("played-once","false"),this.el.emit("switch-room",t)}}),Dn.a.registerComponent("play-once",{init:function(){var t=this;this.el.addEventListener("sound-ended",(function(){0!==t.el.components.sound.pool.children[0].offset&&"false"!==t.el.getAttribute("paused")||t.el.setAttribute("played-once",!0)}))}}),i.a.render(Object(zt.jsx)(o.a.StrictMode,{children:Object(zt.jsx)(s.a,{store:ta,children:Object(zt.jsx)(Ft.Provider,{value:Lt,children:Object(zt.jsx)(qn,{})})})}),document.getElementById("root"))}},[[194,1,2]]]);
//# sourceMappingURL=main.8dc3c507.chunk.js.map